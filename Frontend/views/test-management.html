<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Management - HR Recruitment System</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231e3a8a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><rect width='20' height='14' x='2' y='5' rx='2'/><path d='m9 12 2 2 4-4'/></svg>"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.292.0/dist/umd/lucide.js"></script>
    <style>
      /* Professional Corporate Design */
      .card-sharp {
        border-radius: 0px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .card-hover:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }

      .btn-sharp {
        border-radius: 0px;
      }

      .input-sharp {
        border-radius: 0px;
      }

      /* Professional Color Scheme */
      :root {
        --primary: #1e3a8a; /* Deep Blue */
        --secondary: #64748b; /* Slate Gray */
        --accent: #0ea5e9; /* Sky Blue */
        --success: #059669; /* Emerald */
        --warning: #d97706; /* Amber */
        --danger: #dc2626; /* Red */
        --dark: #0f172a; /* Slate 900 */
        --light: #f8fafc; /* Slate 50 */
      }

      .bg-primary {
        background-color: var(--primary);
      }
      .bg-secondary {
        background-color: var(--secondary);
      }
      .bg-accent {
        background-color: var(--accent);
      }
      .text-primary {
        color: var(--primary);
      }
      .text-secondary {
        color: var(--secondary);
      }
      .border-primary {
        border-color: var(--primary);
      }

      /* Remove all rounded corners */
      * {
        border-radius: 0 !important;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--secondary);
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary);
      }

      .transition-all {
        transition: all 0.2s ease-in-out;
      }

      /* Login Form Styles */
      .login-container {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        min-height: 100vh;
      }

      .test-link-status {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .status-active {
        background-color: #dcfce7;
        color: #166534;
      }
      .status-inactive {
        background-color: #fee2e2;
        color: #991b1b;
      }
      .status-expired {
        background-color: #fef3c7;
        color: #92400e;
      }

      .test-type-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        background-color: #6366f1;
      }

      .copy-btn {
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .link-item:hover .copy-btn {
        opacity: 1;
      }
    </style>
  </head>
  <body class="bg-gray-50 font-inter">
    <!-- Login Modal (Initially Hidden) -->
    <div
      id="loginModal"
      class="fixed inset-0 z-50 login-container flex items-center justify-center"
    >
      <div class="bg-white p-10 w-full max-w-lg mx-4 shadow-2xl border">
        <div class="text-center mb-10">
          <div
            class="mx-auto w-20 h-20 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center mb-6"
          >
            <i data-lucide="shield-check" class="w-10 h-10 text-white"></i>
          </div>
          <h2 class="text-3xl font-bold text-gray-900 mb-2">
            HR Recruitment System
          </h2>
          <p class="text-gray-600 text-lg">Login untuk Akses Dashboard</p>
        </div>

        <form id="loginForm" class="space-y-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-3"
              >Email HR</label
            >
            <input
              type="email"
              id="email"
              class="w-full px-4 py-4 border border-gray-300 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"
              placeholder="hr@company.com"
              autocomplete="email"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-3"
              >Password</label
            >
            <input
              type="password"
              id="password"
              class="w-full px-4 py-4 border border-gray-300 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"
              placeholder="••••••••"
              autocomplete="current-password"
              required
            />
          </div>

          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <input type="checkbox" id="remember" class="mr-3 w-4 h-4" />
              <label for="remember" class="text-sm text-gray-600"
                >Ingat saya</label
              >
            </div>
            <a
              href="#"
              class="text-sm text-blue-600 hover:text-blue-800 font-medium"
              >Lupa password?</a
            >
          </div>

          <button
            type="submit"
            class="w-full bg-gradient-to-r from-blue-600 to-purple-700 hover:from-blue-700 hover:to-purple-800 text-white py-4 px-6 font-semibold transition-all transform hover:scale-[1.02]"
          >
            Login ke Dashboard
          </button>

          <div class="text-center">
            <p class="text-sm text-gray-500">
              Demo: hr@company.com / password123
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- Main Application (Initially Hidden) -->
    <div id="mainApp" class="hidden">
      <!-- Modern Sidebar Layout -->
      <div class="flex h-screen bg-gray-50">
        <!-- Sidebar -->
        <div
          class="hidden lg:flex lg:flex-col lg:w-64 lg:fixed lg:inset-y-0 z-50"
        >
          <div
            class="flex-1 flex flex-col min-h-0 bg-white border-r border-gray-200"
          >
            <!-- Logo -->
            <div class="flex-1 flex flex-col pt-5 pb-4 overflow-y-auto">
              <div class="flex items-center flex-shrink-0 px-6">
                <div
                  class="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center"
                >
                  <i data-lucide="briefcase" class="w-5 h-5 text-white"></i>
                </div>
                <div class="ml-3">
                  <h1 class="text-lg font-bold text-gray-900">HR System</h1>
                  <p class="text-xs text-gray-500">Test Management</p>
                </div>
              </div>

              <!-- Navigation -->
              <nav class="mt-8 flex-1 px-4 space-y-1">
                <a
                  href="dashboard.html"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="home"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Dashboard
                </a>
                <a
                  href="kandidat.html"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="users"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Kandidat
                </a>
                <a
                  href="posisi.html"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="briefcase"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Posisi
                </a>
                <a
                  href="test-management.html"
                  class="sidebar-item active bg-blue-50 border-r-2 border-blue-600 text-blue-700 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="file-text"
                    class="text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Test Management
                </a>
                <a
                  href="analytics.html"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="bar-chart-3"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Analytics
                </a>
                <a
                  href="laporan.html"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="file-bar-chart"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Laporan
                </a>
                <a
                  href="form-apply.html"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="file-plus"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Form Apply
                </a>
                <a
                  href="/admin/tests"
                  class="sidebar-item text-gray-700 hover:text-blue-700 hover:bg-blue-50 group flex items-center px-3 py-3 text-sm font-medium"
                >
                  <i
                    data-lucide="settings"
                    class="text-gray-400 group-hover:text-blue-500 mr-3 h-5 w-5"
                  ></i>
                  Admin Tes
                </a>
              </nav>
            </div>

            <!-- User Profile -->
            <div class="flex-shrink-0 flex border-t border-gray-200 p-4">
              <div class="flex items-center">
                <div
                  class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center"
                >
                  <span
                    class="text-white text-sm font-semibold"
                    id="sidebarUserInitial"
                    >H</span
                  >
                </div>
                <div class="ml-3">
                  <p
                    class="text-sm font-medium text-gray-700"
                    id="sidebarUserName"
                  >
                    HR Manager
                  </p>
                  <p class="text-xs text-gray-500" id="sidebarUserEmail">
                    hr@company.com
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mobile sidebar -->
        <div
          id="mobileSidebar"
          class="lg:hidden fixed inset-0 flex z-40 hidden"
        >
          <div
            class="fixed inset-0 bg-gray-600 bg-opacity-75"
            onclick="toggleMobileSidebar()"
          ></div>
          <div class="relative flex-1 flex flex-col max-w-xs w-full bg-white">
            <div class="absolute top-0 right-0 -mr-12 pt-2">
              <button
                onclick="toggleMobileSidebar()"
                class="ml-1 flex items-center justify-center h-10 w-10 text-white"
              >
                <i data-lucide="x" class="h-6 w-6"></i>
              </button>
            </div>
            <!-- Mobile sidebar content same as desktop -->
            <div class="flex-1 h-0 pt-5 pb-4 overflow-y-auto">
              <div class="flex-shrink-0 flex items-center px-4">
                <div
                  class="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center"
                >
                  <i data-lucide="briefcase" class="w-5 h-5 text-white"></i>
                </div>
                <h1 class="ml-3 text-lg font-bold text-gray-900">HR System</h1>
              </div>
              <nav class="mt-5 px-2 space-y-1">
                <a
                  href="dashboard.html"
                  class="mobile-sidebar-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-base font-medium"
                >
                  <i data-lucide="home" class="text-gray-400 mr-4 h-6 w-6"></i>
                  Dashboard
                </a>
                <a
                  href="kandidat.html"
                  class="mobile-sidebar-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-base font-medium"
                >
                  <i data-lucide="users" class="text-gray-400 mr-4 h-6 w-6"></i>
                  Kandidat
                </a>
                <a
                  href="posisi.html"
                  class="mobile-sidebar-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-base font-medium"
                >
                  <i
                    data-lucide="briefcase"
                    class="text-gray-400 mr-4 h-6 w-6"
                  ></i>
                  Posisi
                </a>
                <a
                  href="test-management.html"
                  class="mobile-sidebar-item active bg-blue-100 text-blue-900 group flex items-center px-2 py-2 text-base font-medium"
                >
                  <i
                    data-lucide="file-text"
                    class="text-blue-500 mr-4 h-6 w-6"
                  ></i>
                  Test Management
                </a>
              </nav>
            </div>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="lg:pl-64 flex flex-col flex-1">
          <!-- Top Header -->
          <div
            class="sticky top-0 z-10 lg:hidden pl-1 pt-1 sm:pl-3 sm:pt-3 bg-gray-50"
          >
            <button
              onclick="toggleMobileSidebar()"
              class="-ml-0.5 -mt-0.5 h-12 w-12 inline-flex items-center justify-center text-gray-500 hover:text-gray-900 focus:outline-none"
            >
              <i data-lucide="menu" class="h-6 w-6"></i>
            </button>
          </div>

          <!-- Header with notifications -->
          <header
            class="bg-white shadow-sm border-b border-gray-200 lg:border-l-0"
          >
            <div class="px-4 sm:px-6 lg:px-8">
              <div class="flex justify-between items-center h-16">
                <div class="flex-1">
                  <h1 class="text-2xl font-bold text-gray-900" id="pageTitle">
                    Manajemen Test
                  </h1>
                  <p class="text-sm text-gray-600" id="pageSubtitle">
                    Kelola test links DISC dan monitor submission
                  </p>
                </div>

                <!-- Right side actions -->
                <div class="flex items-center space-x-4">
                  <!-- Create Test Link -->
                  <button
                    onclick="createTestLink()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 font-medium transition-colors flex items-center"
                  >
                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                    Buat Test Link
                  </button>

                  <!-- Refresh Button -->
                  <button
                    onclick="refreshTestData()"
                    class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors"
                  >
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                  </button>

                  <!-- Notifications -->
                  <button
                    class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors relative"
                  >
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span
                      id="notificationCount"
                      class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs flex items-center justify-center font-bold rounded-full"
                      >0</span
                    >
                  </button>

                  <!-- User Menu -->
                  <div class="relative">
                    <button
                      onclick="toggleUserMenu()"
                      class="flex items-center space-x-3 p-2 text-sm rounded-lg hover:bg-gray-100 transition-colors"
                    >
                      <div
                        class="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center"
                      >
                        <span
                          class="text-white text-sm font-semibold"
                          id="headerUserInitial"
                          >H</span
                        >
                      </div>
                      <div class="hidden sm:block text-left">
                        <div
                          class="font-medium text-gray-700"
                          id="headerUserName"
                        >
                          HR Manager
                        </div>
                        <div class="text-xs text-gray-500" id="headerUserEmail">
                          hr@company.com
                        </div>
                      </div>
                      <i
                        data-lucide="chevron-down"
                        class="w-4 h-4 text-gray-400"
                      ></i>
                    </button>

                    <!-- Dropdown menu -->
                    <div
                      id="userMenu"
                      class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20"
                    >
                      <a
                        href="#"
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        >Profile</a
                      >
                      <a
                        href="#"
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        >Settings</a
                      >
                      <div class="border-t border-gray-200"></div>
                      <button
                        onclick="logout()"
                        class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                      >
                        Logout
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </header>

          <!-- Tab Navigation -->
          <div class="bg-white border-b">
            <div class="px-4 sm:px-6 lg:px-8">
              <nav class="flex space-x-8" aria-label="Tabs">
                <button
                  onclick="switchTab('test-links')"
                  id="tab-test-links"
                  class="py-4 px-1 border-b-2 border-primary font-medium text-sm text-primary"
                >
                  Test Links
                </button>
                <button
                  onclick="switchTab('categories')"
                  id="tab-categories"
                  class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm"
                >
                  Categories & Questions
                </button>
                <button
                  onclick="switchTab('submissions')"
                  id="tab-submissions"
                  class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm"
                >
                  Submissions
                </button>
              </nav>
            </div>
          </div>

          <!-- Main Content -->
          <main class="flex-1 overflow-y-auto">
            <div class="px-4 sm:px-6 lg:px-8 py-8">
              <!-- Test Links Tab Content -->
              <div id="test-links-content" class="tab-content">
                <!-- Stats Section -->
                <div class="mb-8">
                  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <!-- Total Test Links -->
                    <div class="bg-white p-6 shadow border border-gray-200">
                      <div class="flex items-center">
                        <div
                          class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center"
                        >
                          <i data-lucide="link" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="ml-4">
                          <p class="text-sm font-medium text-gray-500">
                            Total Test Links
                          </p>
                          <p
                            class="text-2xl font-bold text-gray-900"
                            id="totalTestLinksCount"
                          >
                            0
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Active Links -->
                    <div class="bg-white p-6 shadow border border-gray-200">
                      <div class="flex items-center">
                        <div
                          class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center"
                        >
                          <i
                            data-lucide="check-circle"
                            class="w-5 h-5 text-white"
                          ></i>
                        </div>
                        <div class="ml-4">
                          <p class="text-sm font-medium text-gray-500">
                            Active Links
                          </p>
                          <p
                            class="text-2xl font-bold text-gray-900"
                            id="activeTestLinksCount"
                          >
                            0
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Total Submissions -->
                    <div class="bg-white p-6 shadow border border-gray-200">
                      <div class="flex items-center">
                        <div
                          class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center"
                        >
                          <i
                            data-lucide="file-check"
                            class="w-5 h-5 text-white"
                          ></i>
                        </div>
                        <div class="ml-4">
                          <p class="text-sm font-medium text-gray-500">
                            Total Submissions
                          </p>
                          <p
                            class="text-2xl font-bold text-gray-900"
                            id="totalSubmissionsCount"
                          >
                            0
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Completion Rate -->
                    <div class="bg-white p-6 shadow border border-gray-200">
                      <div class="flex items-center">
                        <div
                          class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center"
                        >
                          <i
                            data-lucide="target"
                            class="w-5 h-5 text-white"
                          ></i>
                        </div>
                        <div class="ml-4">
                          <p class="text-sm font-medium text-gray-500">
                            Completion Rate
                          </p>
                          <p
                            class="text-2xl font-bold text-gray-900"
                            id="completionRateDisplay"
                          >
                            0%
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Test Links Management -->
                <div class="bg-white shadow border border-gray-200 mb-8">
                  <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                      <h3 class="text-lg font-semibold text-gray-900">
                        Test Links Management
                      </h3>
                      <div class="flex items-center space-x-2">
                        <button
                          onclick="bulkToggleLinks()"
                          class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 font-medium transition-colors flex items-center"
                        >
                          <i data-lucide="toggle-left" class="w-4 h-4 mr-2"></i>
                          Bulk Toggle
                        </button>
                        <button
                          onclick="exportTestData()"
                          class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 font-medium transition-colors flex items-center"
                        >
                          <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                          Export
                        </button>
                      </div>
                    </div>
                  </div>

                  <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                      <thead class="bg-gray-50">
                        <tr>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            <input
                              type="checkbox"
                              id="selectAllLinks"
                              class="mr-2"
                            />
                            Test Link
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Position
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Status
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Usage
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Expires
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Actions
                          </th>
                        </tr>
                      </thead>
                      <tbody
                        id="testLinksTableBody"
                        class="bg-white divide-y divide-gray-200"
                      >
                        <!-- Loading state -->
                        <tr>
                          <td colspan="6" class="px-6 py-12 text-center">
                            <div
                              class="flex items-center justify-center text-gray-500"
                            >
                              <i
                                data-lucide="loader-2"
                                class="w-6 h-6 animate-spin mr-3"
                              ></i>
                              Loading test links data...
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- Recent Submissions -->
                <div class="bg-white shadow border border-gray-200">
                  <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                      <h3 class="text-lg font-semibold text-gray-900">
                        Recent Test Submissions
                      </h3>
                      <button
                        onclick="viewAllSubmissions()"
                        class="text-blue-600 hover:text-blue-800 font-medium"
                      >
                        View All →
                      </button>
                    </div>
                  </div>

                  <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                      <thead class="bg-gray-50">
                        <tr>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Candidate
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Position
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            DISC Result
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Score
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Completed
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Actions
                          </th>
                        </tr>
                      </thead>
                      <tbody
                        id="submissionsTableBody"
                        class="bg-white divide-y divide-gray-200"
                      >
                        <!-- Loading state -->
                        <tr>
                          <td colspan="6" class="px-6 py-12 text-center">
                            <div
                              class="flex items-center justify-center text-gray-500"
                            >
                              <i
                                data-lucide="loader-2"
                                class="w-6 h-6 animate-spin mr-3"
                              ></i>
                              Loading submissions data...
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- End Test Links Tab Content -->

              <!-- Categories & Questions Tab Content -->
              <div id="categories-content" class="tab-content hidden">
                <div class="mb-6 flex justify-between items-center">
                  <div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">
                      Test Categories & Questions
                    </h2>
                    <p class="text-gray-600">
                      Manage test categories and questions for assessments
                    </p>
                  </div>
                  <button
                    onclick="openCategoryModal()"
                    class="bg-primary hover:opacity-90 text-white px-4 py-2 flex items-center space-x-2 transition-all"
                  >
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    <span>Add Category</span>
                  </button>
                </div>

                <div
                  id="categoriesGrid"
                  class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8"
                >
                  <!-- Categories will be loaded here -->
                  <div class="col-span-full text-center py-8 text-gray-500">
                    <i
                      data-lucide="loader-2"
                      class="w-8 h-8 animate-spin mx-auto mb-3"
                    ></i>
                    <p>Loading categories...</p>
                  </div>
                </div>

                <!-- Questions for selected category -->
                <div id="questionsSection" class="hidden">
                  <div class="mb-6 flex justify-between items-center">
                    <div>
                      <h3 class="text-xl font-bold text-gray-900 mb-2">
                        Questions
                      </h3>
                      <p class="text-gray-600" id="selectedCategoryName">
                        Select a category to manage questions
                      </p>
                    </div>
                    <button
                      onclick="showAddQuestionModal()"
                      class="bg-primary text-white px-4 py-2 hover:opacity-90 transition-colors flex items-center space-x-2"
                    >
                      <i data-lucide="plus" class="w-4 h-4"></i>
                      <span>Add Question</span>
                    </button>
                  </div>

                  <div id="questionsList" class="space-y-4">
                    <!-- Questions will be loaded here -->
                  </div>
                </div>
              </div>
              <!-- End Categories Tab Content -->

              <!-- Submissions Tab Content -->
              <div id="submissions-content" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">
                  All Submissions
                </h2>
                <div class="bg-white shadow border border-gray-200">
                  <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                      <thead class="bg-gray-50">
                        <tr>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Candidate
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Position
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            DISC Result
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Score
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Completed
                          </th>
                          <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Actions
                          </th>
                        </tr>
                      </thead>
                      <tbody
                        id="allSubmissionsTableBody"
                        class="bg-white divide-y divide-gray-200"
                      >
                        <tr>
                          <td
                            colspan="6"
                            class="px-6 py-12 text-center text-gray-500"
                          >
                            <i
                              data-lucide="loader-2"
                              class="w-6 h-6 animate-spin mx-auto mb-3"
                            ></i>
                            Loading submissions...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- End Submissions Tab Content -->
            </div>
          </main>
        </div>
      </div>
    </div>

    <!-- Add/Edit Category Modal -->
    <div
      id="categoryModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white shadow-xl max-w-lg w-full">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex justify-between items-center">
              <h3
                id="categoryModalTitle"
                class="text-lg font-medium text-gray-900"
              >
                Add New Category
              </h3>
              <button
                onclick="closeCategoryModal()"
                class="text-gray-400 hover:text-gray-600"
              >
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </div>
          </div>

          <form id="categoryForm" class="px-6 py-4 space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Category Name</label
              >
              <input
                type="text"
                id="categoryName"
                required
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="e.g., Personality Test"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Category Code</label
              >
              <input
                type="text"
                id="categoryCode"
                required
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="e.g., DISC"
              />
              <p class="mt-1 text-sm text-gray-500">
                Unique identifier for this category
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Description</label
              >
              <textarea
                id="categoryDescription"
                rows="3"
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Describe what this category tests..."
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Color Theme</label
              >
              <div class="flex space-x-2">
                <input
                  type="color"
                  id="categoryColor"
                  value="#3b82f6"
                  class="w-12 h-10 border border-gray-300"
                />
                <input
                  type="text"
                  id="categoryColorText"
                  value="#3b82f6"
                  class="flex-1 px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
            </div>

            <div
              class="flex justify-end space-x-3 pt-4 border-t border-gray-200"
            >
              <button
                type="button"
                onclick="closeCategoryModal()"
                class="px-4 py-2 border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-primary text-white text-sm font-medium hover:opacity-90"
              >
                Save Category
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add/Edit Question Modal -->
    <div
      id="questionModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto"
        >
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex justify-between items-center">
              <h3 id="modalTitle" class="text-lg font-medium text-gray-900">
                Add New Question
              </h3>
              <button
                onclick="closeQuestionModal()"
                class="text-gray-400 hover:text-gray-600"
              >
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </div>
          </div>

          <form id="questionForm" class="px-6 py-4 space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Question Type</label
              >
              <select
                id="questionType"
                onchange="updateQuestionFields()"
                required
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="">Select type...</option>
                <option value="ranking">Ranking (Most/Least)</option>
                <option value="binary_choice">Binary Choice (A/B)</option>
                <option value="multiple_choice">Multiple Choice</option>
                <option value="scale">Scale Rating</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Question Text</label
              >
              <textarea
                id="questionText"
                required
                rows="3"
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Enter the question text..."
              ></textarea>
            </div>

            <div id="optionsSection" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Options</label
              >
              <div id="optionsList" class="space-y-2">
                <!-- Options will be added dynamically -->
              </div>
              <button
                type="button"
                onclick="addOption()"
                class="mt-2 text-blue-600 hover:text-blue-800 text-sm flex items-center space-x-1"
              >
                <i data-lucide="plus" class="w-4 h-4"></i>
                <span>Add Option</span>
              </button>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Order Index</label
              >
              <input
                type="number"
                id="orderIndex"
                min="0"
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="0"
              />
            </div>

            <div
              class="flex justify-end space-x-3 pt-4 border-t border-gray-200"
            >
              <button
                type="button"
                onclick="closeQuestionModal()"
                class="px-4 py-2 border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-primary text-white text-sm font-medium hover:opacity-90"
              >
                Save Question
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Create Test Link Modal -->
    <div
      id="createTestLinkModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto"
        >
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-medium text-gray-900">
                Create New Test Link
              </h3>
              <button
                onclick="closeTestLinkModal()"
                class="text-gray-400 hover:text-gray-600"
              >
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </div>
          </div>

          <form id="testLinkForm" class="px-6 py-4 space-y-4">
            <!-- Step 1: Select Category -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Select Test Category</label
              >
              <select
                id="linkCategoryId"
                required
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="">Choose category...</option>
              </select>
              <p class="mt-1 text-sm text-gray-500">
                The category containing questions for this test
              </p>
            </div>

            <!-- Step 2: Candidate Info -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Candidate Name *</label
              >
              <input
                type="text"
                id="linkCandidateName"
                required
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="John Doe"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Candidate Email</label
              >
              <input
                type="email"
                id="linkCandidateEmail"
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="john@example.com"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Position Applied</label
              >
              <input
                type="text"
                id="linkPosition"
                class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Software Engineer"
              />
            </div>

            <!-- Step 3: Link Settings -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Usage Limit</label
                >
                <input
                  type="number"
                  id="linkUsageLimit"
                  min="1"
                  value="1"
                  class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="1"
                />
                <p class="mt-1 text-sm text-gray-500">
                  Maximum number of test attempts
                </p>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Expires At *</label
                >
                <input
                  type="datetime-local"
                  id="linkExpiresAt"
                  required
                  class="block w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
            </div>

            <!-- Link Preview -->
            <div id="linkPreviewSection" class="hidden">
              <div class="bg-green-50 border border-green-200 p-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i data-lucide="link" class="inline w-4 h-4 mr-1"></i>
                  Generated Test Link:
                </label>
                <div
                  class="bg-white border border-gray-300 p-3 font-mono text-sm break-all"
                  id="generatedTestLink"
                ></div>
                <button
                  type="button"
                  onclick="copyGeneratedLink()"
                  class="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 font-medium transition-colors"
                >
                  <i data-lucide="copy" class="inline w-4 h-4 mr-2"></i>
                  Copy Link
                </button>
              </div>
            </div>

            <div
              class="flex justify-end space-x-3 pt-4 border-t border-gray-200"
            >
              <button
                type="button"
                onclick="closeTestLinkModal()"
                class="px-4 py-2 border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                type="submit"
                id="generateLinkBtn"
                class="px-4 py-2 bg-primary text-white text-sm font-medium hover:opacity-90"
              >
                Generate Test Link
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3011/api";
      let currentCategoryId = null;
      let editingQuestionId = null;
      let currentTab = "test-links";
      // Initialize user from localStorage
      let currentUser = localStorage.getItem("hr_user")
        ? JSON.parse(localStorage.getItem("hr_user"))
        : null;

      // DUMMY DATA
      let categories = [
        {
          id: 1,
          name: "Test CPNS 2025",
          code: "CPNS2025",
          description:
            "Test seleksi CPNS tahun 2025 meliputi TWK, TIU, dan TKP",
          color: "#3b82f6",
          question_count: 5,
          is_active: true,
          created_at: new Date().toISOString(),
        },
        {
          id: 2,
          name: "Test Potensi Akademik",
          code: "TPA",
          description:
            "Test untuk mengukur potensi akademik dan kemampuan berpikir logis",
          color: "#10b981",
          question_count: 4,
          is_active: true,
          created_at: new Date().toISOString(),
        },
        {
          id: 3,
          name: "Test Bahasa Inggris",
          code: "ENGLISH",
          description:
            "Test kemampuan bahasa Inggris untuk level intermediate-advance",
          color: "#f59e0b",
          question_count: 3,
          is_active: true,
          created_at: new Date().toISOString(),
        },
      ];

      let currentQuestions = [];

      let allQuestions = {
        1: [
          // CPNS 2025
          {
            id: 1,
            category_id: 1,
            question_text:
              "Pancasila sebagai dasar negara Indonesia disahkan pada tanggal...",
            question_type: "multiple_choice",
            options: JSON.stringify([
              "17 Agustus 1945",
              "18 Agustus 1945",
              "1 Juni 1945",
              "22 Juni 1945",
            ]),
            order_index: 0,
          },
          {
            id: 2,
            category_id: 1,
            question_text: "Berapa hasil dari 15 x 8 + 120 ÷ 6?",
            question_type: "multiple_choice",
            options: JSON.stringify(["140", "150", "160", "170"]),
            order_index: 1,
          },
          {
            id: 3,
            category_id: 1,
            question_text:
              "Seorang ASN harus memiliki integritas tinggi dalam menjalankan tugasnya.",
            question_type: "binary_choice",
            options: JSON.stringify(["Benar", "Salah"]),
            order_index: 2,
          },
          {
            id: 4,
            category_id: 1,
            question_text:
              "UUD 1945 pertama kali disahkan oleh PPKI pada tanggal 18 Agustus 1945.",
            question_type: "binary_choice",
            options: JSON.stringify(["Benar", "Salah"]),
            order_index: 3,
          },
          {
            id: 5,
            category_id: 1,
            question_text: "Siapa presiden pertama Indonesia?",
            question_type: "multiple_choice",
            options: JSON.stringify([
              "Ir. Soekarno",
              "Mohammad Hatta",
              "Soeharto",
              "B.J. Habibie",
            ]),
            order_index: 4,
          },
        ],
        2: [
          // TPA
          {
            id: 6,
            category_id: 2,
            question_text:
              "Jika semua A adalah B, dan semua B adalah C, maka...",
            question_type: "multiple_choice",
            options: JSON.stringify([
              "Semua A adalah C",
              "Semua C adalah A",
              "Tidak ada A yang C",
              "Sebagian A adalah C",
            ]),
            order_index: 0,
          },
          {
            id: 7,
            category_id: 2,
            question_text:
              "Deret angka: 2, 6, 12, 20, 30, ... Angka selanjutnya adalah?",
            question_type: "multiple_choice",
            options: JSON.stringify(["40", "42", "44", "46"]),
            order_index: 1,
          },
          {
            id: 8,
            category_id: 2,
            question_text: "Jika 3x + 5 = 20, maka nilai x adalah...",
            question_type: "multiple_choice",
            options: JSON.stringify(["3", "5", "7", "9"]),
            order_index: 2,
          },
          {
            id: 9,
            category_id: 2,
            question_text: 'Sinonim dari kata "KONSISTEN" adalah...',
            question_type: "multiple_choice",
            options: JSON.stringify([
              "Berubah-ubah",
              "Tetap",
              "Dinamis",
              "Fleksibel",
            ]),
            order_index: 3,
          },
        ],
        3: [
          // English
          {
            id: 10,
            category_id: 3,
            question_text: "Choose the correct sentence:",
            question_type: "multiple_choice",
            options: JSON.stringify([
              "She don't like coffee",
              "She doesn't like coffee",
              "She didn't likes coffee",
              "She doesn't likes coffee",
            ]),
            order_index: 0,
          },
          {
            id: 11,
            category_id: 3,
            question_text: 'What is the synonym of "difficult"?',
            question_type: "multiple_choice",
            options: JSON.stringify(["Easy", "Hard", "Simple", "Clear"]),
            order_index: 1,
          },
          {
            id: 12,
            category_id: 3,
            question_text: 'The past tense of "go" is "went".',
            question_type: "binary_choice",
            options: JSON.stringify(["True", "False"]),
            order_index: 2,
          },
        ],
      };

      let testLinksData = [
        {
          id: 1,
          testName: "Test CPNS 2025 - John Doe",
          position: "Software Engineer",
          status: "active",
          usage: { current: 0, limit: 1 },
          expires: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
          createdDate: new Date().toISOString(),
          token: "test_1_example_token_123",
          candidateName: "John Doe",
        },
        {
          id: 2,
          testName: "Test TPA - Jane Smith",
          position: "Product Manager",
          status: "active",
          usage: { current: 1, limit: 1 },
          expires: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
          createdDate: new Date().toISOString(),
          token: "test_2_example_token_456",
          candidateName: "Jane Smith",
        },
      ];

      let submissionsData = [
        {
          id: 1,
          candidateName: "Alice Johnson",
          email: "alice@example.com",
          position: "Frontend Developer",
          discResult: "D - Dominant",
          score: 85,
          completedDate: new Date().toLocaleDateString("id-ID"),
        },
        {
          id: 2,
          candidateName: "Bob Wilson",
          email: "bob@example.com",
          position: "Backend Developer",
          discResult: "I - Influential",
          score: 78,
          completedDate: new Date().toLocaleDateString("id-ID"),
        },
      ];

      // Initialize Lucide icons
      lucide.createIcons();

      // Sidebar Navigation Functions
      function toggleMobileSidebar() {
        const sidebar = document.getElementById("mobileSidebar");
        sidebar.classList.toggle("hidden");
      }

      function toggleUserMenu() {
        const userMenu = document.getElementById("userMenu");
        userMenu.classList.toggle("hidden");
      }

      // Close user menu when clicking outside
      document.addEventListener("click", function (event) {
        const userMenu = document.getElementById("userMenu");
        const userButton = event.target.closest('[onclick="toggleUserMenu()"]');

        if (!userButton && !userMenu.contains(event.target)) {
          userMenu.classList.add("hidden");
        }
      });

      // Load test management data (using dummy data)
      async function loadTestData() {
        try {
          console.log("Loading test management data...");

          // Simulate API delay
          await new Promise((resolve) => setTimeout(resolve, 300));

          // Use dummy data (already defined above)
          // Ensure each test link has a direct URL to `test.html` for local testing
          try {
            const baseUrl = window.location.origin;
            testLinksData = (testLinksData || []).map((link) => ({
              ...link,
              link:
                link.link ||
                `${baseUrl}/views/test.html?token=${
                  link.token
                }&candidate=${encodeURIComponent(link.candidateName)}`,
            }));
          } catch (e) {
            console.warn("Could not set link property for testLinksData:", e);
          }

          // Update UI with data
          updateTestLinksUI();
          updateSubmissionsUI();
          updateStats();

          console.log("✅ Test management data loaded successfully");
        } catch (error) {
          console.error("Error loading test data:", error);
          showErrorState();
        }
      }

      // Update test links table UI
      function updateTestLinksUI() {
        const tbody = document.getElementById("testLinksTableBody");

        if (testLinksData.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center">
                            <div class="text-gray-500">
                                <i data-lucide="link" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                                <p class="text-lg font-medium">No test links found</p>
                                <p class="text-sm">Create your first test link to get started.</p>
                            </div>
                        </td>
                    </tr>
                `;
          lucide.createIcons();
          return;
        }

        tbody.innerHTML = (Array.isArray(testLinksData) ? testLinksData : [])
          .map(
            (link) => `
                <tr class="link-item hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <input type="checkbox" class="link-checkbox mr-3" value="${
                              link?.id || ""
                            }">
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900">${
                                  link?.testName || "Unnamed Link"
                                }</div>
                                <div class="text-xs text-gray-500 flex items-center">
                                    <a href="${
                                      link?.link || "#"
                                    }" class="font-mono text-blue-600 hover:underline" target="_blank" rel="noopener noreferrer">${
              link?.link || "#"
            }</a>
                                    <button onclick="copyToClipboard('${
                                      link?.link || ""
                                    }')" class="copy-btn ml-2 text-blue-600 hover:text-blue-800">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${
                          link.position
                        }</div>
                        <div class="text-xs text-gray-500">Created: ${
                          link.createdDate
                            ? new Date(link.createdDate).toLocaleString("id-ID")
                            : ""
                        }</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="test-link-status status-${link.status}">
                            ${
                              link.status.charAt(0).toUpperCase() +
                              link.status.slice(1)
                            }
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${
                          link.usage.current
                        }/${link.usage.limit}</div>
                        <div class="w-full bg-gray-200 h-2 mt-1">
                            <div class="bg-blue-600 h-2" style="width: ${
                              (link.usage.current / link.usage.limit) * 100
                            }%"></div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${link.expires}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="viewTestLinkDetails('${
                              link.id
                            }')" class="text-blue-600 hover:text-blue-900">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="editTestLink('${
                              link.id
                            }')" class="text-green-600 hover:text-green-900">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="toggleTestLink('${
                              link.id
                            }')" class="text-orange-600 hover:text-orange-900">
                                <i data-lucide="toggle-${
                                  link.status === "active" ? "left" : "right"
                                }" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteTestLink('${
                              link.id
                            }')" class="text-red-600 hover:text-red-900">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `
          )
          .join("");

        lucide.createIcons();
      }

      // Update submissions table UI
      function updateSubmissionsUI() {
        const tbody = document.getElementById("submissionsTableBody");

        // Show only recent submissions (last 5)
        const recentSubmissions = submissionsData.slice(-5);

        if (recentSubmissions.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center">
                            <div class="text-gray-500">
                                <i data-lucide="file-check" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                                <p class="text-lg font-medium">No submissions found</p>
                                <p class="text-sm">Test submissions will appear here.</p>
                            </div>
                        </td>
                    </tr>
                `;
          lucide.createIcons();
          return;
        }

        tbody.innerHTML = recentSubmissions
          .map(
            (submission) => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${
                          submission.candidateName
                        }</div>
                        <div class="text-sm text-gray-500">${
                          submission.candidateEmail
                        }</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${submission.position}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="test-type-badge">
                            ${submission.discResult}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${
                          submission.score
                        }%</div>
                        <div class="w-16 bg-gray-200 h-2 mt-1">
                            <div class="bg-green-600 h-2" style="width: ${
                              submission.score
                            }%"></div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${new Date(submission.completedAt).toLocaleDateString(
                          "id-ID"
                        )}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="viewSubmissionDetails(${
                              submission.id
                            })" class="text-blue-600 hover:text-blue-900">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="downloadReport(${
                              submission.id
                            })" class="text-green-600 hover:text-green-900">
                                <i data-lucide="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `
          )
          .join("");

        lucide.createIcons();
      }

      // Update statistics
      function updateStats() {
        const totalTestLinks = testLinksData.length;
        const activeTestLinks = (
          Array.isArray(testLinksData) ? testLinksData : []
        ).filter((link) => link.status === "active").length;
        const totalSubmissions = submissionsData.length;
        const totalUsage = (
          Array.isArray(testLinksData) ? testLinksData : []
        ).reduce((sum, link) => sum + link.usage.current, 0);
        const totalLimit = (
          Array.isArray(testLinksData) ? testLinksData : []
        ).reduce((sum, link) => sum + link.usage.limit, 0);
        const completionRate =
          totalLimit > 0 ? Math.round((totalUsage / totalLimit) * 100) : 0;

        document.getElementById("totalTestLinksCount").textContent =
          totalTestLinks;
        document.getElementById("activeTestLinksCount").textContent =
          activeTestLinks;
        document.getElementById("totalSubmissionsCount").textContent =
          totalSubmissions;
        document.getElementById(
          "completionRateDisplay"
        ).textContent = `${completionRate}%`;

        // Update notification count (pending submissions or expiring links)
        const expiringLinks = (
          Array.isArray(testLinksData) ? testLinksData : []
        ).filter((link) => {
          const expDate = new Date(link.expires);
          const now = new Date();
          const daysUntilExpiry = (expDate - now) / (1000 * 60 * 60 * 24);
          return daysUntilExpiry <= 7 && daysUntilExpiry > 0;
        }).length;

        document.getElementById("notificationCount").textContent =
          expiringLinks;
        document.getElementById("notificationCount").style.display =
          expiringLinks > 0 ? "flex" : "none";
      }

      // Show error state
      function showErrorState() {
        const testLinksBody = document.getElementById("testLinksTableBody");
        const submissionsBody = document.getElementById("submissionsTableBody");

        const errorHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-12 text-center">
                        <div class="text-red-500">
                            <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-4"></i>
                            <p class="text-lg font-medium">Error loading data</p>
                            <p class="text-sm">Please try refreshing the page.</p>
                        </div>
                    </td>
                </tr>
            `;

        testLinksBody.innerHTML = errorHTML;
        submissionsBody.innerHTML = errorHTML;
        lucide.createIcons();
      }

      // Action functions
      async function createTestLink() {
        // Load categories first
        await loadCategoriesForLink();

        // Set default expiry (24 hours from now)
        const now = new Date();
        now.setHours(now.getHours() + 24);
        const dateStr = now.toISOString().slice(0, 16);
        document.getElementById("linkExpiresAt").value = dateStr;

        // Show modal
        document
          .getElementById("createTestLinkModal")
          .classList.remove("hidden");
        lucide.createIcons();
      }

      function closeTestLinkModal() {
        document.getElementById("createTestLinkModal").classList.add("hidden");
        document.getElementById("testLinkForm").reset();
        document.getElementById("linkPreviewSection").classList.add("hidden");
      }

      async function loadCategoriesForLink() {
        // Use dummy data
        const select = document.getElementById("linkCategoryId");
        select.innerHTML =
          '<option value="">Choose category...</option>' +
          categories
            .map(
              (cat) => `
                    <option value="${cat.id}">${cat.name} (${cat.code})</option>
                `
            )
            .join("");
      }

      // Test Link Form Submission (using dummy data)
      document
        .getElementById("testLinkForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const categoryId = parseInt(
            document.getElementById("linkCategoryId").value
          );
          const candidateName =
            document.getElementById("linkCandidateName").value;
          const candidateEmail =
            document.getElementById("linkCandidateEmail").value || null;
          const position =
            document.getElementById("linkPosition").value || "N/A";
          const usageLimit =
            parseInt(document.getElementById("linkUsageLimit").value) || 1;
          const expiresAt = document.getElementById("linkExpiresAt").value;

          // Generate token
          const token = `test_${categoryId}_${Date.now()}_${Math.random()
            .toString(36)
            .substr(2, 9)}`;

          // Find category name
          const category = categories.find((c) => c.id === categoryId);
          const categoryName = category ? category.name : "Unknown";

          // Create new test link
          const newTestLink = {
            id:
              testLinksData.length > 0
                ? Math.max(...testLinksData.map((t) => t.id)) + 1
                : 1,
            testName: `${categoryName} - ${candidateName}`,
            position: position,
            status: "active",
            usage: { current: 0, limit: usageLimit },
            expires: expiresAt,
            createdDate: new Date().toISOString(),
            token: token,
            candidateName: candidateName,
            candidateEmail: candidateEmail,
          };

          // Generate URL -> point to test.html so clicking opens the local test page
          const baseUrl = window.location.origin;
          const testUrl = `${baseUrl}/views/test.html?token=${token}&candidate=${encodeURIComponent(
            candidateName
          )}`;

          // Attach link to the new test link object for table rendering
          newTestLink.link = testUrl;
          testLinksData.push(newTestLink);

          // Show link preview
          document.getElementById("generatedTestLink").textContent = testUrl;
          document
            .getElementById("linkPreviewSection")
            .classList.remove("hidden");
          document.getElementById("generateLinkBtn").disabled = true;

          showNotification("Test link generated successfully!", "success");

          // Reload test links data
          await loadTestData();

          lucide.createIcons();
        });

      function copyGeneratedLink() {
        const link = document.getElementById("generatedTestLink").textContent;
        navigator.clipboard
          .writeText(link)
          .then(() => {
            showNotification("Link copied to clipboard!", "success");
          })
          .catch((err) => {
            console.error("Failed to copy:", err);
            alert("Failed to copy link. Please copy manually.");
          });
      }

      function refreshTestData() {
        console.log("Refreshing test data...");
        loadTestData();
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert("Link copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
          });
      }

      function viewTestLinkDetails(id) {
        const link = testLinksData.find((l) => l.id === id);
        if (!link) {
          alert("Test link not found!");
          return;
        }

        const details = `
Test Link Details:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Test Name: ${link.testName}
Candidate: ${link.candidateName}
Email: ${link.candidateEmail || "N/A"}
Position: ${link.position}
Status: ${link.status}
Usage: ${link.usage.current} / ${link.usage.limit}
Expires: ${new Date(link.expires).toLocaleString("id-ID")}
Created: ${new Date(link.createdDate).toLocaleString("id-ID")}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Token: ${link.token}
Link: ${
          link.link ||
          `${window.location.origin}/views/test.html?token=${
            link.token
          }&candidate=${encodeURIComponent(link.candidateName)}`
        }
            `;

        alert(details);
      }

      function editTestLink(id) {
        const link = testLinksData.find((l) => l.id === id);
        if (!link) {
          alert("Test link not found!");
          return;
        }

        alert(
          `Edit functionality coming soon!\n\nTest: ${link.testName}\nCandidate: ${link.candidateName}`
        );
      }

      function toggleTestLink(id) {
        const link = testLinksData.find((l) => l.id === id);
        link.status = link.status === "active" ? "inactive" : "active";
        updateTestLinksUI();
        updateStats();
      }

      function deleteTestLink(id) {
        if (confirm("Are you sure you want to delete this test link?")) {
          testLinksData = testLinksData.filter((l) => l.id !== id);
          updateTestLinksUI();
          updateStats();
        }
      }

      function viewSubmissionDetails(id) {
        const submission = submissionsData.find((s) => s.id === id);
        alert(`View submission details for: ${submission.candidateName}`);
      }

      function downloadReport(id) {
        const submission = submissionsData.find((s) => s.id === id);
        alert(`Download report for: ${submission.candidateName}`);
      }

      function viewAllSubmissions() {
        alert("View all submissions functionality would be implemented here");
      }

      function bulkToggleLinks() {
        alert("Bulk toggle functionality would be implemented here");
      }

      function exportTestData() {
        alert("Export test data functionality would be implemented here");
      }

      // Login success handler
      function loginSuccess(userData) {
        currentUser = userData;
        // Save user data to localStorage
        localStorage.setItem("hr_user", JSON.stringify(userData));

        // Update user info in header and sidebar
        updateUserUI(userData);

        // Hide login, show main app
        document.getElementById("loginModal").classList.add("hidden");
        document.getElementById("mainApp").classList.remove("hidden");

        // Load test data
        loadTestData();
      }

      // Update user UI elements
      function updateUserUI(userData) {
        if (document.getElementById("headerUserEmail")) {
          document.getElementById("headerUserEmail").textContent =
            userData.email;
        }
        if (document.getElementById("headerUserName")) {
          document.getElementById("headerUserName").textContent = userData.name;
        }
        if (document.getElementById("headerUserInitial")) {
          document.getElementById("headerUserInitial").textContent =
            userData.name.charAt(0);
        }
        if (document.getElementById("sidebarUserEmail")) {
          document.getElementById("sidebarUserEmail").textContent =
            userData.email;
        }
        if (document.getElementById("sidebarUserName")) {
          document.getElementById("sidebarUserName").textContent =
            userData.name;
        }
        if (document.getElementById("sidebarUserInitial")) {
          document.getElementById("sidebarUserInitial").textContent =
            userData.name.charAt(0);
        }
      }

      // Check authentication state on page load
      function checkAuthState() {
        if (currentUser) {
          // User is already logged in
          document.getElementById("loginModal").classList.add("hidden");
          document.getElementById("mainApp").classList.remove("hidden");
          // Update UI with user info
          updateUserUI(currentUser);
          // Load test data
          loadTestData();
        } else {
          // Show login modal
          document.getElementById("loginModal").classList.remove("hidden");
          document.getElementById("mainApp").classList.add("hidden");
        }
      }

      // Login functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Check if user is already logged in
        checkAuthState();

        // Set up login form
        document
          .getElementById("loginForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            // Demo login validation
            if (email === "hr@company.com" && password === "password123") {
              const userData = {
                email: email,
                name: "HR Manager",
                role: "hr_manager",
              };

              loginSuccess(userData);
            } else {
              alert(
                "Email atau password salah. Gunakan: hr@company.com / password123"
              );
            }
          });
      });

      // Logout functionality
      function logout() {
        currentUser = null;
        // Clear localStorage
        localStorage.removeItem("hr_user");
        document.getElementById("loginModal").classList.remove("hidden");
        document.getElementById("mainApp").classList.add("hidden");
      }

      // Tab switching
      window.switchTab = function (tabName) {
        currentTab = tabName;

        // Update tab buttons
        document.querySelectorAll('[id^="tab-"]').forEach((tab) => {
          tab.classList.remove("border-primary", "text-primary");
          tab.classList.add("border-transparent", "text-gray-500");
        });

        document
          .getElementById(`tab-${tabName}`)
          .classList.remove("border-transparent", "text-gray-500");
        document
          .getElementById(`tab-${tabName}`)
          .classList.add("border-primary", "text-primary");

        // Update content
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.add("hidden");
        });

        document
          .getElementById(`${tabName}-content`)
          .classList.remove("hidden");

        // Load data based on active tab
        if (tabName === "categories") {
          loadCategories();
        } else if (tabName === "submissions") {
          loadAllSubmissions();
        }
      };

      // Load categories (using dummy data)
      async function loadCategories() {
        // Simulate API delay
        await new Promise((resolve) => setTimeout(resolve, 300));
        renderCategories();
      }

      // Render categories
      function renderCategories() {
        const grid = document.getElementById("categoriesGrid");

        if (categories.length === 0) {
          grid.innerHTML =
            '<div class="col-span-full text-center py-8 text-gray-500">No categories found. Click "Add Category" to create your first test category.</div>';
          return;
        }

        grid.innerHTML = categories
          .map(
            (category) => `
                <div class="bg-white border border-gray-200 p-6 transition-all hover:shadow-lg cursor-pointer" onclick="viewCategoryQuestions(${
                  category.id
                })">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 flex items-center justify-center text-white font-bold text-lg" style="background-color: ${
                              category.color || "#3b82f6"
                            }">${category.name.charAt(0)}</div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${
                                  category.name
                                }</h3>
                                <p class="text-sm text-gray-500">${
                                  category.code
                                }</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="event.stopPropagation(); openCategoryModal(${
                              category.id
                            })" class="text-blue-600 hover:text-blue-800 p-1">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button onclick="event.stopPropagation(); deleteCategory(${
                              category.id
                            })" class="text-red-600 hover:text-red-800 p-1">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mb-4">
                        <p class="text-gray-600 text-sm">${
                          category.description || "No description available"
                        }</p>
                    </div>

                    <div class="flex items-center justify-between text-sm text-gray-500">
                        <span>${category.question_count || 0} questions</span>
                        <span class="text-blue-600 hover:text-blue-800 font-medium">View Questions →</span>
                    </div>
                </div>
            `
          )
          .join("");

        lucide.createIcons();
      }

      // View category questions
      function viewCategoryQuestions(categoryId) {
        currentCategoryId = categoryId;
        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        document.getElementById("selectedCategoryName").textContent =
          category.name;
        document.getElementById("questionsSection").classList.remove("hidden");

        loadQuestionsForCategory(categoryId);
      }

      // Load questions for category (using dummy data)
      async function loadQuestionsForCategory(categoryId) {
        // Simulate API delay
        await new Promise((resolve) => setTimeout(resolve, 300));
        currentQuestions = allQuestions[categoryId] || [];
        renderQuestions();
      }

      // Render questions
      function renderQuestions() {
        const container = document.getElementById("questionsList");

        if (currentQuestions.length === 0) {
          container.innerHTML =
            '<div class="text-center py-8 text-gray-500">No questions found for this category</div>';
          return;
        }

        container.innerHTML = currentQuestions
          .map(
            (question) => `
                <div class="bg-white border border-gray-200 p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5">${
                                  question.question_type
                                }</span>
                                <span class="text-sm text-gray-500">Order: ${
                                  question.order_index
                                }</span>
                            </div>
                            <p class="text-gray-900 font-medium">${
                              question.question_text
                            }</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editQuestion(${
                              question.id
                            })" class="text-blue-600 hover:text-blue-800">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteQuestion(${
                              question.id
                            })" class="text-red-600 hover:text-red-800">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    ${
                      question.options
                        ? `
                        <div class="mt-4">
                            <p class="text-sm font-medium text-gray-700 mb-2">Options:</p>
                            <div class="text-sm text-gray-600">
                                ${
                                  typeof question.options === "string"
                                    ? JSON.parse(question.options).map
                                      ? JSON.parse(question.options)
                                          .map((opt, i) => `${i + 1}. ${opt}`)
                                          .join("<br>")
                                      : Object.entries(
                                          JSON.parse(question.options)
                                        )
                                          .map(([key, val]) => `${key}: ${val}`)
                                          .join("<br>")
                                    : "Invalid options format"
                                }
                            </div>
                        </div>
                    `
                        : ""
                    }
                </div>
            `
          )
          .join("");

        lucide.createIcons();
      }

      // Category Modal Functions
      window.openCategoryModal = function (categoryId = null) {
        currentCategoryId = categoryId;
        const modal = document.getElementById("categoryModal");
        const title = document.getElementById("categoryModalTitle");
        const form = document.getElementById("categoryForm");

        if (categoryId) {
          title.textContent = "Edit Category";
          const category = categories.find((c) => c.id === categoryId);
          if (category) {
            document.getElementById("categoryName").value = category.name || "";
            document.getElementById("categoryCode").value = category.code || "";
            document.getElementById("categoryDescription").value =
              category.description || "";
            document.getElementById("categoryColor").value =
              category.color || "#3b82f6";
            document.getElementById("categoryColorText").value =
              category.color || "#3b82f6";
          }
        } else {
          title.textContent = "Add New Category";
          form.reset();
          document.getElementById("categoryColor").value = "#3b82f6";
          document.getElementById("categoryColorText").value = "#3b82f6";
        }

        modal.classList.remove("hidden");
        lucide.createIcons();
      };

      window.closeCategoryModal = function () {
        document.getElementById("categoryModal").classList.add("hidden");
        currentCategoryId = null;
      };

      // Category form submission (using dummy data)
      document
        .getElementById("categoryForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const name = document.getElementById("categoryName").value;
          const code = document.getElementById("categoryCode").value;
          const description = document.getElementById(
            "categoryDescription"
          ).value;
          const color = document.getElementById("categoryColor").value;

          if (currentCategoryId) {
            // Update existing category
            const index = categories.findIndex(
              (c) => c.id === currentCategoryId
            );
            if (index !== -1) {
              categories[index] = {
                ...categories[index],
                name,
                code,
                description,
                color,
              };
              showNotification("Category updated successfully!", "success");
            }
          } else {
            // Create new category
            const newCategory = {
              id:
                categories.length > 0
                  ? Math.max(...categories.map((c) => c.id)) + 1
                  : 1,
              name,
              code,
              description,
              color,
              question_count: 0,
              is_active: true,
              created_at: new Date().toISOString(),
            };
            categories.push(newCategory);
            allQuestions[newCategory.id] = [];
            showNotification("Category created successfully!", "success");
          }

          closeCategoryModal();
          await loadCategories();
        });

      // Delete category (using dummy data)
      async function deleteCategory(categoryId) {
        if (!confirm("Are you sure you want to delete this category?")) return;

        categories = categories.filter((c) => c.id !== categoryId);
        delete allQuestions[categoryId];

        showNotification("Category deleted successfully!", "success");
        await loadCategories();

        // Hide questions section if deleted category was selected
        if (currentCategoryId === categoryId) {
          document.getElementById("questionsSection").classList.add("hidden");
          currentCategoryId = null;
        }
      }

      // Question Modal Functions
      window.showAddQuestionModal = function () {
        if (!currentCategoryId) {
          alert("Please select a category first!");
          return;
        }
        editingQuestionId = null;
        document.getElementById("modalTitle").textContent = "Add New Question";
        document.getElementById("questionForm").reset();
        document.getElementById("optionsSection").classList.add("hidden");
        document.getElementById("questionModal").classList.remove("hidden");
        lucide.createIcons();
      };

      window.closeQuestionModal = function () {
        document.getElementById("questionModal").classList.add("hidden");
        editingQuestionId = null;
      };

      // Update question fields based on type
      function updateQuestionFields() {
        const questionType = document.getElementById("questionType").value;
        const optionsSection = document.getElementById("optionsSection");

        if (
          questionType === "ranking" ||
          questionType === "multiple_choice" ||
          questionType === "binary_choice"
        ) {
          optionsSection.classList.remove("hidden");
          setupOptionsForType(questionType);
        } else {
          optionsSection.classList.add("hidden");
        }
      }

      // Setup options for type
      function setupOptionsForType(type) {
        const optionsList = document.getElementById("optionsList");
        optionsList.innerHTML = "";

        if (type === "binary_choice") {
          for (let i = 0; i < 2; i++) {
            addOption();
          }
        } else if (type === "ranking" || type === "multiple_choice") {
          for (let i = 0; i < 4; i++) {
            addOption();
          }
        }
      }

      // Add option
      window.addOption = function () {
        const optionsList = document.getElementById("optionsList");
        const optionDiv = document.createElement("div");

        optionDiv.classList.add("flex", "space-x-2");
        optionDiv.innerHTML = `
                <input type="text" class="option-input flex-1 px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter option text...">
                <button type="button" onclick="removeOption(this)" class="text-red-600 hover:text-red-800 p-2">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;
        optionsList.appendChild(optionDiv);
        lucide.createIcons();
      };

      // Remove option
      window.removeOption = function (button) {
        button.closest(".flex").remove();
      };

      // Edit question
      function editQuestion(questionId) {
        const question = currentQuestions.find((q) => q.id === questionId);
        if (!question) return;

        editingQuestionId = questionId;
        document.getElementById("modalTitle").textContent = "Edit Question";

        document.getElementById("questionType").value = question.question_type;
        document.getElementById("questionText").value = question.question_text;
        document.getElementById("orderIndex").value = question.order_index;

        updateQuestionFields();

        if (question.options) {
          const options =
            typeof question.options === "string"
              ? JSON.parse(question.options)
              : question.options;
          const optionInputs = document.querySelectorAll(".option-input");

          if (Array.isArray(options)) {
            options.forEach((opt, index) => {
              if (optionInputs[index]) {
                optionInputs[index].value = opt;
              }
            });
          }
        }

        document.getElementById("questionModal").classList.remove("hidden");
        lucide.createIcons();
      }

      // Delete question (using dummy data)
      async function deleteQuestion(questionId) {
        if (!confirm("Are you sure you want to delete this question?")) return;

        if (allQuestions[currentCategoryId]) {
          allQuestions[currentCategoryId] = allQuestions[
            currentCategoryId
          ].filter((q) => q.id !== questionId);

          // Update category question count
          const catIndex = categories.findIndex(
            (c) => c.id === currentCategoryId
          );
          if (catIndex !== -1) {
            categories[catIndex].question_count =
              allQuestions[currentCategoryId].length;
          }
        }

        showNotification("Question deleted successfully!", "success");
        await loadQuestionsForCategory(currentCategoryId);
      }

      // Question form submission (using dummy data)
      document
        .getElementById("questionForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const questionText = document.getElementById("questionText").value;
          const questionType = document.getElementById("questionType").value;
          const orderIndex =
            parseInt(document.getElementById("orderIndex").value) || 0;

          // Collect options
          const optionInputs = document.querySelectorAll(".option-input");
          const options = Array.from(optionInputs)
            .map((input) => input.value)
            .filter((val) => val.trim());

          if (editingQuestionId) {
            // Update existing question
            const question = allQuestions[currentCategoryId].find(
              (q) => q.id === editingQuestionId
            );
            if (question) {
              question.question_text = questionText;
              question.question_type = questionType;
              question.order_index = orderIndex;
              question.options = JSON.stringify(options);
              showNotification("Question updated successfully!", "success");
            }
          } else {
            // Create new question
            if (!allQuestions[currentCategoryId]) {
              allQuestions[currentCategoryId] = [];
            }

            const newId =
              Math.max(
                0,
                ...Object.values(allQuestions)
                  .flat()
                  .map((q) => q.id)
              ) + 1;
            const newQuestion = {
              id: newId,
              category_id: currentCategoryId,
              question_text: questionText,
              question_type: questionType,
              options: JSON.stringify(options),
              order_index: orderIndex,
            };

            allQuestions[currentCategoryId].push(newQuestion);

            // Update category question count
            const catIndex = categories.findIndex(
              (c) => c.id === currentCategoryId
            );
            if (catIndex !== -1) {
              categories[catIndex].question_count =
                allQuestions[currentCategoryId].length;
            }

            showNotification("Question created successfully!", "success");
          }

          closeQuestionModal();
          await loadQuestionsForCategory(currentCategoryId);
        });

      // Load all submissions
      function loadAllSubmissions() {
        // Reuse existing submissions data
        const tbody = document.getElementById("allSubmissionsTableBody");
        tbody.innerHTML = submissionsData
          .map(
            (submission) => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div>
                                <div class="text-sm font-medium text-gray-900">${
                                  submission.candidateName
                                }</div>
                                <div class="text-sm text-gray-500">${
                                  submission.email || "N/A"
                                }</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      submission.position
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="test-type-badge">${
                          submission.discResult
                        }</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      submission.score
                    }%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                      submission.completedDate
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="viewSubmissionDetails(${
                              submission.id
                            })" class="text-blue-600 hover:text-blue-900">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="downloadReport(${
                              submission.id
                            })" class="text-green-600 hover:text-green-900">
                                <i data-lucide="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `
          )
          .join("");

        lucide.createIcons();
      }

      // Show notification
      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.className = `fixed top-4 right-4 px-4 py-2 shadow-lg z-50 ${
          type === "success"
            ? "bg-green-100 text-green-800 border border-green-200"
            : type === "error"
            ? "bg-red-100 text-red-800 border border-red-200"
            : "bg-blue-100 text-blue-800 border border-blue-200"
        }`;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      // Color picker sync
      document
        .getElementById("categoryColor")
        .addEventListener("change", function (e) {
          document.getElementById("categoryColorText").value = e.target.value;
        });

      document
        .getElementById("categoryColorText")
        .addEventListener("change", function (e) {
          document.getElementById("categoryColor").value = e.target.value;
        });
    </script>
  </body>
</html>
