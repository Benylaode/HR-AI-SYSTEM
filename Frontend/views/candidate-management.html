<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Kandidat - HR Recruitment System</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.292.0/dist/umd/lucide.js"></script>
    <style>
      /* Professional Corporate Design */
      .card-sharp {
        border-radius: 0px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .btn-sharp {
        border-radius: 0px;
      }

      .input-sharp {
        border-radius: 0px;
      }

      /* Remove all rounded corners */
      * {
        border-radius: 0 !important;
      }

      /* Professional Color Scheme */
      :root {
        --primary: #1e3a8a;
        --secondary: #64748b;
        --accent: #0ea5e9;
        --success: #059669;
        --warning: #d97706;
        --danger: #dc2626;
        --dark: #0f172a;
        --light: #f8fafc;
      }

      .bg-primary {
        background-color: var(--primary);
      }
      .bg-secondary {
        background-color: var(--secondary);
      }
      .text-primary {
        color: var(--primary);
      }
      .border-primary {
        border-color: var(--primary);
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--secondary);
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary);
      }

      .transition-all {
        transition: all 0.2s ease-in-out;
      }

      /* Table styles */
      .data-table {
        border-collapse: collapse;
        width: 100%;
      }

      .data-table th {
        background-color: var(--primary);
        color: white;
        font-weight: 600;
        padding: 12px 16px;
        text-align: left;
        border-bottom: 2px solid #e5e7eb;
      }

      .data-table td {
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
      }

      .data-table tbody tr:hover {
        background-color: #f8fafc;
      }

      /* Status badges */
      .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-new {
        background-color: #dbeafe;
        color: #1e40af;
      }
      .status-interview {
        background-color: #fef3c7;
        color: #92400e;
      }
      .status-hired {
        background-color: #d1fae5;
        color: #065f46;
      }
      .status-rejected {
        background-color: #fee2e2;
        color: #dc2626;
      }

      /* Filter panel */
      .filter-panel {
        background: #f8fafc;
        border: 1px solid #e5e7eb;
        padding: 20px;
      }

      /* Action buttons */
      .action-btn {
        padding: 6px 12px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
      }

      .action-btn:hover {
        transform: translateY(-1px);
      }

      /* DISC Score visualization */
      .disc-score {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 2px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
      }

      .disc-d {
        background-color: #dc2626;
        color: white;
      }
      .disc-i {
        background-color: #d97706;
        color: white;
      }
      .disc-s {
        background-color: #059669;
        color: white;
      }
      .disc-c {
        background-color: #1e40af;
        color: white;
      }

      /* Modal styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background: white;
        max-width: 800px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        padding: 0;
      }
      /* Standard Navbar Styles */
      .nav-item {
        color: #64748b;
        border-radius: 0px;
      }

      .nav-item:hover {
        color: var(--primary);
        background-color: #f8fafc;
      }

      .nav-item.active {
        color: var(--primary);
        background-color: #eff6ff;
        font-weight: 600;
      }

      .mobile-nav-item {
        color: #64748b;
        border-radius: 0px;
      }

      .mobile-nav-item:hover {
        color: var(--primary);
        background-color: #f8fafc;
      }

      .mobile-nav-item.active {
        color: var(--primary);
        background-color: #eff6ff;
        font-weight: 600;
      }
    </style>
  </head>
  <body class="bg-slate-50 min-h-screen">
    <!-- Standard HR Navbar Component -->
    <header
      class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-40"
    >
      <div class="max-w-7xl mx-auto px-6">
        <div class="flex justify-between items-center h-16">
          <!-- Logo & Navigation -->
          <div class="flex items-center space-x-8">
            <!-- Logo -->
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-primary flex items-center justify-center">
                <i data-lucide="briefcase" class="w-5 h-5 text-white"></i>
              </div>
              <div>
                <h1 class="text-lg font-bold text-slate-900">
                  HR Recruitment System
                </h1>
                <p class="text-xs text-slate-500">Management Kandidat</p>
              </div>
            </div>

            <!-- Navigation Menu -->
            <nav class="hidden md:flex items-center space-x-1">
              <a
                href="/"
                class="nav-item flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors"
              >
                <i data-lucide="home" class="w-4 h-4"></i>
                <span>Dashboard</span>
              </a>
              <a
                href="/candidates"
                class="nav-item active flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors"
              >
                <i data-lucide="users" class="w-4 h-4"></i>
                <span>Kandidat</span>
              </a>
              <a
                href="/jobs"
                class="nav-item flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors"
              >
                <i data-lucide="briefcase" class="w-4 h-4"></i>
                <span>Posisi</span>
              </a>
              <a
                href="/reports"
                class="nav-item flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors"
              >
                <i data-lucide="bar-chart-4" class="w-4 h-4"></i>
                <span>Laporan</span>
              </a>
              <a
                href="/apply"
                class="nav-item flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors"
              >
                <i data-lucide="file-plus" class="w-4 h-4"></i>
                <span>Form Apply</span>
              </a>
              <a
                href="/admin/tests"
                class="nav-item flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors"
              >
                <i data-lucide="settings" class="w-4 h-4"></i>
                <span>Admin Tes</span>
              </a>
            </nav>

            <!-- Mobile Menu Button -->
            <button
              class="md:hidden p-2 text-slate-600 hover:text-primary"
              onclick="toggleMobileMenu()"
            >
              <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
          </div>

          <!-- User Profile & Actions -->
          <div class="flex items-center space-x-4">
            <!-- Notifications -->
            <button
              class="p-2 text-slate-600 hover:text-primary transition-colors relative"
            >
              <i data-lucide="bell" class="w-5 h-5"></i>
              <span
                class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs flex items-center justify-center font-bold"
                style="border-radius: 0"
                >3</span
              >
            </button>

            <!-- User Profile -->
            <div class="flex items-center space-x-3">
              <div
                class="w-8 h-8 bg-slate-600 flex items-center justify-center"
              >
                <span class="text-white text-sm font-semibold">H</span>
              </div>
              <div class="hidden sm:block text-sm">
                <div class="font-medium text-slate-900">HR Manager</div>
                <div class="text-slate-500 text-xs">hr@company.com</div>
              </div>
            </div>

            <!-- Logout Button -->
            <button
              onclick="logout()"
              class="btn-sharp px-4 py-2 border border-slate-300 text-slate-700 hover:bg-slate-50 transition-all text-sm"
            >
              <i data-lucide="log-out" class="w-4 h-4 mr-1 inline"></i>
              <span class="hidden sm:inline">Logout</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Navigation Menu -->
      <div
        id="mobileMenu"
        class="md:hidden border-t border-slate-200 bg-white hidden"
      >
        <div class="px-6 py-4 space-y-2">
          <a
            href="/"
            class="mobile-nav-item flex items-center space-x-3 px-3 py-2 text-sm font-medium"
          >
            <i data-lucide="home" class="w-4 h-4"></i>
            <span>Dashboard</span>
          </a>
          <a
            href="/candidates"
            class="mobile-nav-item active flex items-center space-x-3 px-3 py-2 text-sm font-medium"
          >
            <i data-lucide="users" class="w-4 h-4"></i>
            <span>Kandidat</span>
          </a>
          <a
            href="/jobs"
            class="mobile-nav-item flex items-center space-x-3 px-3 py-2 text-sm font-medium"
          >
            <i data-lucide="briefcase" class="w-4 h-4"></i>
            <span>Posisi</span>
          </a>
          <a
            href="/reports"
            class="mobile-nav-item flex items-center space-x-3 px-3 py-2 text-sm font-medium"
          >
            <i data-lucide="bar-chart-4" class="w-4 h-4"></i>
            <span>Laporan</span>
          </a>
          <a
            href="/apply"
            class="mobile-nav-item flex items-center space-x-3 px-3 py-2 text-sm font-medium"
          >
            <i data-lucide="file-plus" class="w-4 h-4"></i>
            <span>Form Apply</span>
          </a>
          <a
            href="/admin/tests"
            class="mobile-nav-item flex items-center space-x-3 px-3 py-2 text-sm font-medium"
          >
            <i data-lucide="settings" class="w-4 h-4"></i>
            <span>Admin Tes</span>
          </a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-8 px-6">
      <!-- Page Header -->
      <div class="mb-8">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-3xl font-bold text-slate-900">Daftar Kandidat</h2>
            <p class="text-slate-600 mt-2">
              Lihat dan review semua aplikasi kandidat
            </p>
          </div>
          <div class="flex items-center space-x-4">
            <button
              onclick="refreshCandidates()"
              class="btn-sharp bg-primary hover:bg-blue-800 text-white px-6 py-2 font-medium transition-all"
            >
              <i data-lucide="refresh-cw" class="w-4 h-4 mr-2 inline"></i
              >Refresh
            </button>
          </div>
        </div>
      </div>

      <!-- Filter and Search Panel -->
      <div class="filter-panel card-sharp mb-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2"
              >Cari Kandidat</label
            >
            <div class="relative">
              <input
                type="text"
                id="searchInput"
                placeholder="Nama, email, posisi..."
                class="input-sharp w-full pl-10 pr-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                onkeyup="filterCandidates()"
              />
              <i
                data-lucide="search"
                class="w-4 h-4 absolute left-3 top-2.5 text-slate-400"
              ></i>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2"
              >Status</label
            >
            <select
              id="statusFilter"
              class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
              onchange="filterCandidates()"
            >
              <option value="">Semua Status</option>
              <option value="new">Baru</option>
              <option value="interview">Interview</option>
              <option value="hired">Hired</option>
              <option value="rejected">Ditolak</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2"
              >Posisi</label
            >
            <select
              id="positionFilter"
              class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
              onchange="filterCandidates()"
            >
              <option value="">Semua Posisi</option>
              <option value="Software Engineer">Software Engineer</option>
              <option value="HR Specialist">HR Specialist</option>
              <option value="Quality Assurance">Quality Assurance</option>
              <option value="Project Manager">Project Manager</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2"
              >Tipe DISC</label
            >
            <select
              id="discFilter"
              class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
              onchange="filterCandidates()"
            >
              <option value="">Semua Tipe</option>
              <option value="DOMINANT">Dominant</option>
              <option value="INFLUENTIAL">Influential</option>
              <option value="STEADY">Steady</option>
              <option value="CONSCIENTIOUS">Conscientious</option>
            </select>
          </div>
        </div>

        <div class="mt-4 flex items-center justify-between">
          <div class="text-sm text-slate-600">
            Total:
            <span id="totalCandidates" class="font-semibold">0</span> kandidat
          </div>
          <button
            onclick="resetFilters()"
            class="text-primary hover:text-blue-800 text-sm font-medium"
          >
            <i data-lucide="x" class="w-4 h-4 inline mr-1"></i>Reset Filter
          </button>
        </div>
      </div>

      <!-- Candidates Table -->
      <div class="bg-white card-sharp border border-slate-200 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="data-table">
            <thead>
              <tr>
                <th>
                  <input
                    type="checkbox"
                    id="selectAll"
                    onchange="toggleSelectAll()"
                    class="mr-2"
                  />
                  Kandidat
                </th>
                <th>Posisi</th>
                <th>Status</th>
                <th>DISC Profile</th>
                <th>Tanggal Apply</th>
                <th>Score</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="candidatesTableBody">
              <!-- Candidates will be loaded here -->
            </tbody>
          </table>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
          <i
            data-lucide="loader-2"
            class="w-8 h-8 text-slate-400 animate-spin mx-auto mb-4"
          ></i>
          <p class="text-slate-600">Memuat data kandidat...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-12 hidden">
          <i
            data-lucide="users"
            class="w-12 h-12 text-slate-400 mx-auto mb-4"
          ></i>
          <h3 class="text-lg font-medium text-slate-900 mb-2">
            Belum ada kandidat
          </h3>
          <p class="text-slate-600">
            Kandidat yang mendaftar akan muncul di sini
          </p>
        </div>
      </div>

      <!-- Pagination -->
      <div class="mt-6 flex items-center justify-between">
        <div class="text-sm text-slate-600">
          Menampilkan <span id="showingFrom">1</span> -
          <span id="showingTo">10</span> dari
          <span id="totalResults">0</span> results
        </div>
        <div class="flex items-center space-x-2">
          <button
            onclick="previousPage()"
            id="prevBtn"
            class="btn-sharp border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 font-medium transition-all disabled:opacity-50"
            disabled
          >
            <i data-lucide="chevron-left" class="w-4 h-4"></i>
          </button>
          <span class="px-4 py-2 text-sm text-slate-600">
            Page <span id="currentPage">1</span> of
            <span id="totalPages">1</span>
          </span>
          <button
            onclick="nextPage()"
            id="nextBtn"
            class="btn-sharp border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 font-medium transition-all disabled:opacity-50"
            disabled
          >
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
          </button>
        </div>
      </div>
    </main>

    <!-- Candidate Detail Modal -->
    <div id="candidateModal" class="modal-overlay hidden">
      <div class="modal-content card-sharp">
        <div
          class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between"
        >
          <h3 class="text-xl font-bold text-slate-900">Detail Kandidat</h3>
          <button
            onclick="closeCandidateModal()"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        <div id="candidateModalContent" class="p-6">
          <!-- Candidate details will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Edit Candidate Modal -->
    <div id="editCandidateModal" class="modal-overlay hidden">
      <div class="modal-content card-sharp max-w-4xl">
        <div
          class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between"
        >
          <h3 class="text-xl font-bold text-slate-900">Edit Kandidat</h3>
          <button
            onclick="closeEditCandidateModal()"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        <div class="p-6">
          <form id="editCandidateForm" class="space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Personal Information -->
              <div class="space-y-4">
                <h4 class="font-bold text-slate-900 mb-4">Informasi Pribadi</h4>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Nama Lengkap</label
                  >
                  <input
                    type="text"
                    id="editFullName"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Email</label
                  >
                  <input
                    type="email"
                    id="editEmail"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Telepon</label
                  >
                  <input
                    type="tel"
                    id="editPhone"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Umur</label
                  >
                  <input
                    type="number"
                    id="editAge"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Jenis Kelamin</label
                  >
                  <select
                    id="editGender"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  >
                    <option value="">Pilih jenis kelamin</option>
                    <option value="Male">Laki-laki</option>
                    <option value="Female">Perempuan</option>
                  </select>
                </div>
              </div>

              <!-- Application Information -->
              <div class="space-y-4">
                <h4 class="font-bold text-slate-900 mb-4">
                  Informasi Aplikasi
                </h4>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Posisi yang Dilamar</label
                  >
                  <input
                    type="text"
                    id="editAppliedPosition"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Status</label
                  >
                  <select
                    id="editStatus"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  >
                    <option value="active">Active</option>
                    <option value="pending">Pending</option>
                    <option value="interview">Interview</option>
                    <option value="interviewed">Interviewed</option>
                    <option value="hired">Hired</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Kota</label
                  >
                  <input
                    type="text"
                    id="editAddressCity"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >Negara</label
                  >
                  <input
                    type="text"
                    id="editAddressCountry"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2"
                    >CV File</label
                  >
                  <input
                    type="text"
                    id="editCvFile"
                    class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                    placeholder="Nama file CV"
                  />
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div
              class="flex justify-end space-x-4 pt-6 border-t border-slate-200"
            >
              <button
                type="button"
                onclick="closeEditCandidateModal()"
                class="btn-sharp border border-slate-300 text-slate-700 hover:bg-slate-50 px-6 py-2 font-medium transition-all"
              >
                Batal
              </button>
              <button
                type="button"
                onclick="saveEditCandidate()"
                class="btn-sharp bg-primary hover:bg-blue-800 text-white px-6 py-2 font-medium transition-all"
              >
                Simpan Perubahan
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Generate Test Link Modal -->
    <div id="testLinkModal" class="modal-overlay hidden">
      <div class="modal-content card-sharp max-w-2xl">
        <div
          class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between"
        >
          <h3 class="text-xl font-bold text-slate-900">Generate Test Link</h3>
          <button
            onclick="closeTestLinkModal()"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        <div class="p-6">
          <div class="mb-6">
            <h4 class="font-bold text-slate-900 mb-2">Kandidat Information</h4>
            <div class="bg-slate-50 p-4 border border-slate-200">
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <strong>Name:</strong> <span id="testCandidateName">-</span>
                </div>
                <div>
                  <strong>Email:</strong> <span id="testCandidateEmail">-</span>
                </div>
                <div>
                  <strong>Position:</strong>
                  <span id="testCandidatePosition">-</span>
                </div>
                <div>
                  <strong>Status:</strong>
                  <span id="testCandidateStatus">-</span>
                </div>
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <h4 class="font-bold text-slate-900">Select Test Types:</h4>

            <div id="testTypesContainer" class="space-y-3">
              <!-- Test categories will be loaded here dynamically -->
              <div class="text-center py-4">
                <i
                  data-lucide="loader-2"
                  class="w-5 h-5 text-slate-400 animate-spin mx-auto mb-2"
                ></i>
                <p class="text-slate-600 text-sm">Loading available tests...</p>
              </div>
            </div>
          </div>

          <div class="mt-6">
            <label class="block text-sm font-medium text-slate-700 mb-2"
              >Test Expiry (Days)</label
            >
            <select
              id="testExpiry"
              class="input-sharp w-full px-4 py-2 border border-slate-300 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
            >
              <option value="7">7 hari</option>
              <option value="14" selected>14 hari</option>
              <option value="30">30 hari</option>
            </select>
          </div>

          <div id="generatedLinkSection" class="mt-6 hidden">
            <h4 class="font-bold text-slate-900 mb-3">Generated Test Link:</h4>
            <div class="bg-green-50 p-4 border border-green-200">
              <div class="flex items-center justify-between">
                <code
                  id="generatedTestLink"
                  class="text-sm text-green-800 break-all"
                ></code>
                <button
                  onclick="copyTestLink()"
                  class="btn-sharp bg-green-600 hover:bg-green-700 text-white px-3 py-1 text-sm ml-2"
                >
                  <i data-lucide="copy" class="w-3 h-3 mr-1 inline"></i>Copy
                </button>
              </div>
            </div>
            <p class="text-sm text-slate-600 mt-2">
              Share this link with the candidate. The link will expire in
              <span id="linkExpiryText">14</span> days.
            </p>
          </div>

          <div
            class="flex justify-end space-x-4 pt-6 border-t border-slate-200 mt-6"
          >
            <button
              type="button"
              onclick="closeTestLinkModal()"
              class="btn-sharp border border-slate-300 text-slate-700 hover:bg-slate-50 px-6 py-2 font-medium transition-all"
            >
              Close
            </button>
            <button
              type="button"
              onclick="createTestLink()"
              id="generateBtn"
              class="btn-sharp bg-primary hover:bg-blue-800 text-white px-6 py-2 font-medium transition-all"
            >
              Generate Link
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3011/api";

      let allCandidates = [];
      let filteredCandidates = [];
      let currentPage = 1;
      const itemsPerPage = 10;
      let selectedCandidates = [];

      // DUMMY DATA - Kandidat lokal untuk testing tanpa backend
      const dummyCandidates = [
        {
          id: 1,
          fullName: "Budi Santoso",
          email: "budi.santoso@example.com",
          phone: "081234567890",
          appliedPosition: "Software Engineer",
          status: "applied",
          appliedDate: "2024-12-01",
          testLink: null,
          testStatus: null,
        },
        {
          id: 2,
          fullName: "Siti Nurhaliza",
          email: "siti.nurhaliza@example.com",
          phone: "082345678901",
          appliedPosition: "Product Manager",
          status: "screening",
          appliedDate: "2024-11-28",
          testLink: null,
          testStatus: "pending",
        },
        {
          id: 3,
          fullName: "Ahmad Wijaya",
          email: "ahmad.wijaya@example.com",
          phone: "083456789012",
          appliedPosition: "UI/UX Designer",
          status: "interview",
          appliedDate: "2024-11-25",
          testLink:
            "http://localhost:5174/views/test.html?token=test_disc_3_abc123&candidate=Ahmad%20Wijaya",
          testStatus: "completed",
        },
        {
          id: 4,
          fullName: "Rina Kusuma",
          email: "rina.kusuma@example.com",
          phone: "084567890123",
          appliedPosition: "Data Analyst",
          status: "applied",
          appliedDate: "2024-12-02",
          testLink: null,
          testStatus: null,
        },
        {
          id: 5,
          fullName: "Rudi Hermawan",
          email: "rudi.hermawan@example.com",
          phone: "085678901234",
          appliedPosition: "Backend Developer",
          status: "screening",
          appliedDate: "2024-11-30",
          testLink: null,
          testStatus: "pending",
        },
      ];

      // Navbar functions
      function toggleMobileMenu() {
        const mobileMenu = document.getElementById("mobileMenu");
        mobileMenu.classList.toggle("hidden");
      }

      function logout() {
        if (confirm("Yakin ingin logout?")) {
          localStorage.removeItem("hr_token");
          localStorage.removeItem("hr_user");
          window.location.href = "/";
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        lucide.createIcons();
        loadCandidates();
      });

      // Load candidates data - menggunakan dummy data lokal (tanpa backend)
      async function loadCandidates() {
        try {
          // Simulasi delay loading
          await new Promise((resolve) => setTimeout(resolve, 300));

          // Gunakan dummy data lokal
          allCandidates = [...dummyCandidates];
          filteredCandidates = [...allCandidates];
          renderCandidatesTable();
          updatePagination();

          console.log("âœ… Loaded dummy candidates data (no backend)");
        } catch (error) {
          console.error("Error loading candidates:", error);
          showEmptyState();
        }
      }

      // Refresh candidates data
      function refreshCandidates() {
        console.log("ðŸ”„ Refreshing candidates...");
        loadCandidates();
      }

      // Render candidates table
      function renderCandidatesTable() {
        const tableBody = document.getElementById("candidatesTableBody");
        const loadingState = document.getElementById("loadingState");
        const emptyState = document.getElementById("emptyState");

        loadingState.classList.add("hidden");

        if (filteredCandidates.length === 0) {
          emptyState.classList.remove("hidden");
          tableBody.innerHTML = "";
          return;
        }

        emptyState.classList.add("hidden");

        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageData = filteredCandidates.slice(startIndex, endIndex);

        tableBody.innerHTML = pageData
          .map(
            (candidate) => `
                <tr class="hover:bg-slate-50">
                    <td>
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" value="${
                              candidate.id
                            }" onchange="toggleCandidateSelection('${
              candidate.id
            }')" class="candidate-checkbox">
                            <div class="w-10 h-10 bg-slate-200 flex items-center justify-center text-slate-600 font-semibold">
                                ${
                                  candidate.fullName
                                    ? candidate.fullName.charAt(0).toUpperCase()
                                    : "N"
                                }
                            </div>
                            <div>
                                <div class="font-semibold text-slate-900">${
                                  candidate.fullName || "N/A"
                                }</div>
                                <div class="text-sm text-slate-600">${
                                  candidate.email || "N/A"
                                }</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="font-medium text-slate-900">${
                          candidate.appliedPosition || "General Position"
                        }</div>
                        <div class="text-sm text-slate-600">${
                          candidate.department || "Various"
                        }</div>
                    </td>
                    <td>
                        <span class="status-badge ${getStatusClass(
                          candidate.status
                        )}">
                            ${getStatusText(candidate.status)}
                        </span>
                    </td>
                    <td>
                        <div class="flex items-center space-x-2">
                            ${
                              candidate.discTest
                                ? `
                                <div class="flex space-x-1">
                                    <div class="disc-score disc-d" title="Dominance">${
                                      candidate.discTest.scores?.D || 0
                                    }</div>
                                    <div class="disc-score disc-i" title="Influence">${
                                      candidate.discTest.scores?.I || 0
                                    }</div>
                                    <div class="disc-score disc-s" title="Steadiness">${
                                      candidate.discTest.scores?.S || 0
                                    }</div>
                                    <div class="disc-score disc-c" title="Compliance">${
                                      candidate.discTest.scores?.C || 0
                                    }</div>
                                </div>
                                <div class="text-xs text-slate-600">
                                    ${
                                      candidate.discTest.personalityType ||
                                      "Unknown"
                                    }
                                </div>
                            `
                                : `
                                <span class="text-sm text-slate-400">Belum test</span>
                            `
                            }
                        </div>
                    </td>
                    <td>
                        <div class="text-sm text-slate-900">${formatDate(
                          candidate.createdAt
                        )}</div>
                        <div class="text-xs text-slate-600">${getTimeAgo(
                          candidate.createdAt
                        )}</div>
                    </td>
                    <td>
                        <div class="font-semibold text-lg ${getScoreColor(
                          candidate.overallScore
                        )}">
                            ${candidate.overallScore || "N/A"}
                        </div>
                        ${
                          candidate.overallScore
                            ? `<div class="text-xs text-slate-600">/ 100</div>`
                            : ""
                        }
                    </td>
                    <td>
                        <div class="flex items-center space-x-2">
                            <button onclick="viewCandidate('${
                              candidate.id
                            }')" class="action-btn bg-blue-50 text-blue-700 hover:bg-blue-100" title="View Details">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `
          )
          .join("");

        // Update totals
        document.getElementById("totalCandidates").textContent =
          filteredCandidates.length;
        document.getElementById("showingFrom").textContent = startIndex + 1;
        document.getElementById("showingTo").textContent = Math.min(
          endIndex,
          filteredCandidates.length
        );
        document.getElementById("totalResults").textContent =
          filteredCandidates.length;

        lucide.createIcons();
      }

      // Filter candidates
      function filterCandidates() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const statusFilter = document.getElementById("statusFilter").value;
        const positionFilter = document.getElementById("positionFilter").value;
        const discFilter = document.getElementById("discFilter").value;

        filteredCandidates = allCandidates.filter((candidate) => {
          const matchesSearch =
            !searchTerm ||
            candidate.fullName?.toLowerCase().includes(searchTerm) ||
            candidate.email?.toLowerCase().includes(searchTerm) ||
            candidate.appliedPosition?.toLowerCase().includes(searchTerm);

          const matchesStatus =
            !statusFilter || candidate.status === statusFilter;
          const matchesPosition =
            !positionFilter || candidate.appliedPosition === positionFilter;
          const matchesDisc =
            !discFilter || candidate.discTest?.personalityType === discFilter;

          return (
            matchesSearch && matchesStatus && matchesPosition && matchesDisc
          );
        });

        currentPage = 1;
        renderCandidatesTable();
        updatePagination();
      }

      // Reset filters
      function resetFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("statusFilter").value = "";
        document.getElementById("positionFilter").value = "";
        document.getElementById("discFilter").value = "";

        filteredCandidates = [...allCandidates];
        currentPage = 1;
        renderCandidatesTable();
        updatePagination();
      }

      // Pagination functions
      function updatePagination() {
        const totalPages = Math.ceil(filteredCandidates.length / itemsPerPage);

        document.getElementById("currentPage").textContent = currentPage;
        document.getElementById("totalPages").textContent = totalPages;

        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage >= totalPages;
      }

      function previousPage() {
        if (currentPage > 1) {
          currentPage--;
          renderCandidatesTable();
          updatePagination();
        }
      }

      function nextPage() {
        const totalPages = Math.ceil(filteredCandidates.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          renderCandidatesTable();
          updatePagination();
        }
      }

      // Candidate actions
      function viewCandidate(candidateId) {
        const candidate = allCandidates.find((c) => c.id === candidateId);
        if (candidate) {
          showCandidateModal(candidate);
        }
      }

      function showCandidateModal(candidate) {
        const modal = document.getElementById("candidateModal");
        const content = document.getElementById("candidateModalContent");

        content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Personal Information -->
                    <div class="bg-slate-50 p-6">
                        <h4 class="font-bold text-slate-900 mb-4">Informasi Pribadi</h4>
                        <div class="space-y-3">
                            <div><strong>Nama:</strong> ${
                              candidate.fullName || "N/A"
                            }</div>
                            <div><strong>Email:</strong> ${
                              candidate.email || "N/A"
                            }</div>
                            <div><strong>Telepon:</strong> ${
                              candidate.phone || "N/A"
                            }</div>
                            <div><strong>Alamat:</strong> ${
                              candidate.address?.street || "N/A"
                            }</div>
                            <div><strong>Kota:</strong> ${
                              candidate.address?.city || "N/A"
                            }</div>
                            <div><strong>Umur:</strong> ${
                              candidate.age || "N/A"
                            } tahun</div>
                            <div><strong>Pendidikan:</strong> ${
                              candidate.education?.[0]?.degree || "N/A"
                            }</div>
                        </div>
                    </div>
                    
                    <!-- Application Details -->
                    <div class="bg-slate-50 p-6">
                        <h4 class="font-bold text-slate-900 mb-4">Detail Aplikasi</h4>
                        <div class="space-y-3">
                            <div><strong>Posisi:</strong> ${
                              candidate.appliedPosition || "N/A"
                            }</div>
                            <div><strong>Status:</strong> <span class="status-badge ${getStatusClass(
                              candidate.status
                            )}">${getStatusText(candidate.status)}</span></div>
                            <div><strong>Tanggal Apply:</strong> ${formatDate(
                              candidate.createdAt
                            )}</div>
                            <div><strong>Overall Score:</strong> ${
                              candidate.overallScore || "N/A"
                            }</div>
                        </div>
                    </div>
                </div>
                
                <!-- DISC Test Results -->
                ${
                  candidate.discTest
                    ? `
                    <div class="mt-6 bg-blue-50 p-6">
                        <h4 class="font-bold text-slate-900 mb-4">Hasil DISC Test</h4>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div class="text-center">
                                <div class="disc-score disc-d mx-auto mb-2">${
                                  candidate.discTest.scores?.D || 0
                                }</div>
                                <div class="text-sm font-medium">Dominance</div>
                            </div>
                            <div class="text-center">
                                <div class="disc-score disc-i mx-auto mb-2">${
                                  candidate.discTest.scores?.I || 0
                                }</div>
                                <div class="text-sm font-medium">Influence</div>
                            </div>
                            <div class="text-center">
                                <div class="disc-score disc-s mx-auto mb-2">${
                                  candidate.discTest.scores?.S || 0
                                }</div>
                                <div class="text-sm font-medium">Steadiness</div>
                            </div>
                            <div class="text-center">
                                <div class="disc-score disc-c mx-auto mb-2">${
                                  candidate.discTest.scores?.C || 0
                                }</div>
                                <div class="text-sm font-medium">Compliance</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-primary">${
                              candidate.discTest.personalityType || "Unknown"
                            }</div>
                            <div class="text-sm text-slate-600 mt-2">${
                              candidate.discTest.analysis ||
                              "Analisis kepribadian tidak tersedia"
                            }</div>
                        </div>
                    </div>
                `
                    : `
                    <div class="mt-6 bg-yellow-50 p-6 text-center">
                        <i data-lucide="alert-triangle" class="w-8 h-8 text-yellow-600 mx-auto mb-2"></i>
                        <h4 class="font-bold text-yellow-800">DISC Test Belum Dilakukan</h4>
                        <p class="text-yellow-700 text-sm mt-1">Kandidat belum menyelesaikan tes kepribadian DISC</p>
                    </div>
                `
                }
                
                <!-- Action Buttons -->
                <div class="mt-6 flex justify-end space-x-4">
                    <button onclick="updateCandidateStatus('${
                      candidate.id
                    }', 'interview')" class="btn-sharp bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 font-medium">
                        Set Interview
                    </button>
                    <button onclick="updateCandidateStatus('${
                      candidate.id
                    }', 'hired')" class="btn-sharp bg-green-600 hover:bg-green-700 text-white px-6 py-2 font-medium">
                        Hire
                    </button>
                    <button onclick="updateCandidateStatus('${
                      candidate.id
                    }', 'rejected')" class="btn-sharp bg-red-600 hover:bg-red-700 text-white px-6 py-2 font-medium">
                        Reject
                    </button>
                </div>
            `;

        modal.classList.remove("hidden");
        lucide.createIcons();
      }

      function closeCandidateModal() {
        document.getElementById("candidateModal").classList.add("hidden");
      }

      // Update candidate status
      async function updateCandidateStatus(candidateId, newStatus) {
        try {
          const response = await fetch(
            `${API_BASE}/candidates/${candidateId}/status`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ status: newStatus }),
            }
          );

          if (response.ok) {
            // Update local data
            const candidate = allCandidates.find((c) => c.id === candidateId);
            if (candidate) {
              candidate.status = newStatus;
            }

            renderCandidatesTable();
            closeCandidateModal();
            showNotification(
              `Status kandidat berhasil diupdate ke ${getStatusText(
                newStatus
              )}`,
              "success"
            );
          }
        } catch (error) {
          console.error("Error updating status:", error);
          showNotification("Gagal mengupdate status kandidat", "error");
        }
      }

      // Export candidates
      function exportCandidates() {
        const csvData = convertToCSV(filteredCandidates);
        downloadCSV(csvData, "candidates.csv");
        showNotification("Data kandidat berhasil diexport", "success");
      }

      // Utility functions
      function getStatusClass(status) {
        switch (status) {
          case "new":
            return "status-new";
          case "interview":
            return "status-interview";
          case "hired":
            return "status-hired";
          case "rejected":
            return "status-rejected";
          default:
            return "status-new";
        }
      }

      function getStatusText(status) {
        switch (status) {
          case "new":
            return "Baru";
          case "interview":
            return "Interview";
          case "hired":
            return "Hired";
          case "rejected":
            return "Ditolak";
          default:
            return "Baru";
        }
      }

      function getScoreColor(score) {
        if (!score) return "text-slate-400";
        if (score >= 80) return "text-green-600";
        if (score >= 60) return "text-yellow-600";
        return "text-red-600";
      }

      function formatDate(dateString) {
        if (!dateString) return "N/A";
        return new Date(dateString).toLocaleDateString("id-ID");
      }

      function getTimeAgo(dateString) {
        if (!dateString) return "";
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffDays === 0) return "Hari ini";
        if (diffDays === 1) return "1 hari yang lalu";
        if (diffDays < 30) return `${diffDays} hari yang lalu`;
        return formatDate(dateString);
      }

      function showNotification(message, type = "info") {
        const bgColor =
          type === "error"
            ? "bg-red-100 border-red-500 text-red-700"
            : type === "success"
            ? "bg-green-100 border-green-500 text-green-700"
            : "bg-blue-100 border-blue-500 text-blue-700";

        const alertDiv = document.createElement("div");
        alertDiv.className = `fixed top-4 right-4 p-4 border-l-4 ${bgColor} z-50 max-w-sm card-sharp`;
        alertDiv.innerHTML = `
                <div class="flex">
                    <div>
                        <p class="font-medium">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            `;

        document.body.appendChild(alertDiv);
        lucide.createIcons();

        setTimeout(() => {
          alertDiv.remove();
        }, 5000);
      }

      function convertToCSV(data) {
        const headers = [
          "Nama",
          "Email",
          "Posisi",
          "Status",
          "Tanggal Apply",
          "DISC Type",
          "Score",
        ];
        const csvRows = [headers.join(",")];

        data.forEach((candidate) => {
          const row = [
            candidate.fullName || "",
            candidate.email || "",
            candidate.appliedPosition || "",
            getStatusText(candidate.status),
            formatDate(candidate.createdAt),
            candidate.discTest?.personalityType || "",
            candidate.overallScore || "",
          ];
          csvRows.push(row.join(","));
        });

        return csvRows.join("\n");
      }

      function downloadCSV(csvData, filename) {
        const blob = new Blob([csvData], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", filename);
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function showEmptyState() {
        document.getElementById("loadingState").classList.add("hidden");
        document.getElementById("emptyState").classList.remove("hidden");
      }

      // Selection functions
      function toggleSelectAll() {
        const selectAll = document.getElementById("selectAll");
        const checkboxes = document.querySelectorAll(".candidate-checkbox");

        checkboxes.forEach((checkbox) => {
          checkbox.checked = selectAll.checked;
        });

        updateSelectedCandidates();
      }

      function toggleCandidateSelection(candidateId) {
        updateSelectedCandidates();
      }

      function updateSelectedCandidates() {
        const checkboxes = document.querySelectorAll(
          ".candidate-checkbox:checked"
        );
        selectedCandidates = Array.from(checkboxes).map((cb) => cb.value);
      }

      // Edit candidate functionality
      let currentEditingCandidateId = null;

      function editCandidate(candidateId) {
        const candidate = allCandidates.find((c) => c.id == candidateId);
        if (!candidate) {
          showNotification("Kandidat tidak ditemukan", "error");
          return;
        }

        currentEditingCandidateId = candidateId;

        // Populate form with candidate data
        document.getElementById("editFullName").value =
          candidate.fullName || "";
        document.getElementById("editEmail").value = candidate.email || "";
        document.getElementById("editPhone").value = candidate.phone || "";
        document.getElementById("editAge").value = candidate.age || "";
        document.getElementById("editGender").value = candidate.gender || "";
        document.getElementById("editAppliedPosition").value =
          candidate.appliedPosition || "";
        document.getElementById("editStatus").value =
          candidate.status || "active";
        document.getElementById("editAddressCity").value =
          candidate.addressCity || "";
        document.getElementById("editAddressCountry").value =
          candidate.addressCountry || "";
        document.getElementById("editCvFile").value = candidate.cvFile || "";

        // Show modal
        document
          .getElementById("editCandidateModal")
          .classList.remove("hidden");
        lucide.createIcons();
      }

      function closeEditCandidateModal() {
        document.getElementById("editCandidateModal").classList.add("hidden");
        currentEditingCandidateId = null;
      }

      async function saveEditCandidate() {
        if (!currentEditingCandidateId) {
          showNotification(
            "Error: Tidak ada kandidat yang sedang diedit",
            "error"
          );
          return;
        }

        // Collect form data
        const updatedData = {
          fullName: document.getElementById("editFullName").value,
          email: document.getElementById("editEmail").value,
          phone: document.getElementById("editPhone").value,
          age: parseInt(document.getElementById("editAge").value) || null,
          gender: document.getElementById("editGender").value,
          appliedPosition: document.getElementById("editAppliedPosition").value,
          status: document.getElementById("editStatus").value,
          addressCity: document.getElementById("editAddressCity").value,
          addressCountry: document.getElementById("editAddressCountry").value,
          cvFile: document.getElementById("editCvFile").value,
        };

        try {
          const response = await fetch(
            `${API_BASE}/candidates/${currentEditingCandidateId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(updatedData),
            }
          );

          if (response.ok) {
            const result = await response.json();

            // Update local candidate data
            const candidateIndex = allCandidates.findIndex(
              (c) => c.id == currentEditingCandidateId
            );
            if (candidateIndex !== -1) {
              // Update with response data or merge with existing
              Object.assign(allCandidates[candidateIndex], updatedData);

              // Update filtered candidates as well
              const filteredIndex = filteredCandidates.findIndex(
                (c) => c.id == currentEditingCandidateId
              );
              if (filteredIndex !== -1) {
                Object.assign(filteredCandidates[filteredIndex], updatedData);
              }
            }

            // Refresh table
            renderCandidatesTable();

            // Close modal
            closeEditCandidateModal();

            showNotification("Data kandidat berhasil diperbarui", "success");
          } else {
            const error = await response.json();
            showNotification(
              `Gagal memperbarui kandidat: ${error.message || "Unknown error"}`,
              "error"
            );
          }
        } catch (error) {
          console.error("Error updating candidate:", error);
          showNotification("Gagal memperbarui kandidat", "error");
        }
      }

      async function deleteCandidate(candidateId) {
        if (confirm("Yakin ingin menghapus kandidat ini?")) {
          try {
            const response = await fetch(
              `${API_BASE}/candidates/${candidateId}`,
              {
                method: "DELETE",
              }
            );

            if (response.ok) {
              // Remove from local data
              allCandidates = allCandidates.filter((c) => c.id != candidateId);
              filteredCandidates = filteredCandidates.filter(
                (c) => c.id != candidateId
              );

              renderCandidatesTable();
              updatePagination();
              showNotification("Kandidat berhasil dihapus", "success");
            } else {
              showNotification("Gagal menghapus kandidat", "error");
            }
          } catch (error) {
            console.error("Error deleting candidate:", error);
            showNotification("Gagal menghapus kandidat", "error");
          }
        }
      }

      async function downloadCV(candidateId) {
        try {
          showNotification("Mempersiapkan download CV...", "info");

          // Create download link and trigger download
          const downloadUrl = `${API_BASE}/candidates/${candidateId}/download-cv`;

          // Create a temporary link element to trigger download
          const link = document.createElement("a");
          link.href = downloadUrl;
          link.style.display = "none";
          document.body.appendChild(link);

          // Trigger download
          link.click();

          // Cleanup
          document.body.removeChild(link);

          showNotification("CV berhasil diunduh", "success");
        } catch (error) {
          console.error("Error downloading CV:", error);
          showNotification("Gagal mengunduh CV", "error");
        }
      }

      function showBulkActions() {
        if (selectedCandidates.length === 0) {
          showNotification("Pilih kandidat terlebih dahulu", "error");
          return;
        }
        showNotification(
          `${selectedCandidates.length} kandidat terpilih`,
          "info"
        );
      }

      // Generate Test Link Functions
      let currentTestCandidateId = null;
      let availableCategories = [];

      function generateTestLink(candidateId) {
        const candidate = allCandidates.find((c) => c.id == candidateId);
        if (!candidate) {
          showNotification("Kandidat tidak ditemukan", "error");
          return;
        }

        currentTestCandidateId = candidateId;

        // Populate candidate info
        document.getElementById("testCandidateName").textContent =
          candidate.fullName || "N/A";
        document.getElementById("testCandidateEmail").textContent =
          candidate.email || "N/A";
        document.getElementById("testCandidatePosition").textContent =
          candidate.appliedPosition || "N/A";
        document.getElementById("testCandidateStatus").textContent =
          getStatusText(candidate.status);

        // Load available test categories
        loadTestCategories();

        // Reset form
        document.getElementById("testExpiry").value = "14";
        document.getElementById("generatedLinkSection").classList.add("hidden");

        // Show modal
        document.getElementById("testLinkModal").classList.remove("hidden");
        lucide.createIcons();
      }

      async function loadTestCategories() {
        const container = document.getElementById("testTypesContainer");

        // For now, use default categories (can switch to API later when backend is ready)
        loadDefaultCategories();

        // Optional: Try to fetch from API in the background for future use
        try {
          const response = await fetch(`${API_BASE}/admin/test-categories`, {
            timeout: 2000,
          });
          const data = await response.json();

          if (data.success && data.categories) {
            availableCategories = data.categories.filter(
              (cat) => cat.is_active
            );
            renderTestCategories();
            console.log("âœ… Loaded test categories from API");
          }
        } catch (error) {
          console.log("â„¹ï¸ Using default test categories (API not available)");
          // Keep using default categories
        }
      }

      function renderTestCategories() {
        const container = document.getElementById("testTypesContainer");

        if (availableCategories.length === 0) {
          container.innerHTML = `
                    <div class="text-center py-4 text-slate-500">
                        <i data-lucide="alert-triangle" class="w-5 h-5 mx-auto mb-2"></i>
                        <p class="text-sm">No active test categories available</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = availableCategories
          .map(
            (category, index) => `
                <label class="flex items-center space-x-3 p-3 border border-slate-200 hover:bg-slate-50 transition-colors">
                    <input type="checkbox" 
                           id="category_${category.id}" 
                           value="${category.id}"
                           class="w-4 h-4 text-primary focus:ring-primary test-category-checkbox"
                           ${index === 0 ? "checked" : ""}>
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            ${
                              category.icon_url
                                ? `<img src="${category.icon_url}" alt="${category.name}" class="w-5 h-5">`
                                : `<div class="w-5 h-5 rounded-sm" style="background-color: ${
                                    category.color || "#3b82f6"
                                  }"></div>`
                            }
                            <div class="font-medium">${category.name}</div>
                        </div>
                        <div class="text-sm text-slate-600 mt-1">
                            ${category.question_count || 0} pertanyaan - ${
              category.description || "Test description not available"
            }
                        </div>
                    </div>
                </label>
            `
          )
          .join("");

        lucide.createIcons();
      }

      function loadDefaultCategories() {
        // Fallback to original hardcoded categories
        availableCategories = [
          {
            id: "disc",
            name: "DISC Personality Test",
            description: "Test kepribadian untuk menentukan gaya kerja",
            question_count: 24,
            color: "#3b82f6",
          },
          {
            id: "msdt",
            name: "MSDT Management Style Test",
            description: "Test gaya manajemen dan kepemimpinan",
            question_count: 64,
            color: "#059669",
          },
          {
            id: "intelligence",
            name: "Army Alpha Intelligence Test",
            description: "Test kecerdasan verbal dan numerik",
            question_count: 12,
            color: "#d97706",
          },
        ];
        renderTestCategories();
      }

      function closeTestLinkModal() {
        document.getElementById("testLinkModal").classList.add("hidden");
        currentTestCandidateId = null;
      }

      async function createTestLink() {
        if (!currentTestCandidateId) {
          showNotification("Error: Tidak ada kandidat yang dipilih", "error");
          return;
        }

        // Collect selected test categories
        const selectedCheckboxes = document.querySelectorAll(
          ".test-category-checkbox:checked"
        );
        const selectedTests = Array.from(selectedCheckboxes).map(
          (checkbox) => checkbox.value
        );

        if (selectedTests.length === 0) {
          showNotification("Pilih minimal satu jenis test", "error");
          return;
        }

        const expiryDays = parseInt(
          document.getElementById("testExpiry").value
        );
        const generateBtn = document.getElementById("generateBtn");

        try {
          generateBtn.disabled = true;
          generateBtn.textContent = "Generating...";

          // Generate test link locally without API call (since backend not ready yet)
          const token = `test_${
            selectedTests[0]
          }_${currentTestCandidateId}_${Date.now()}`;
          const candidateName =
            document.getElementById("testCandidateName").textContent;
          const baseUrl = window.location.origin;
          const testLink = `${baseUrl}/views/test.html?token=${token}&candidate=${encodeURIComponent(
            candidateName
          )}`;

          // Show generated link
          document.getElementById("generatedTestLink").textContent = testLink;
          document.getElementById("linkExpiryText").textContent = expiryDays;
          document
            .getElementById("generatedLinkSection")
            .classList.remove("hidden");

          showNotification("Test link berhasil dibuat!", "success");

          // Optional: Log for debugging
          console.log("Generated test link:", {
            token,
            candidate: candidateName,
            categories: selectedTests,
            expiryDays,
            link: testLink,
          });
        } catch (error) {
          console.error("Error creating test link:", error);
          showNotification("Gagal membuat test link", "error");
        } finally {
          generateBtn.disabled = false;
          generateBtn.textContent = "Generate Link";
        }
      }

      function copyTestLink() {
        const linkElement = document.getElementById("generatedTestLink");
        const link = linkElement.textContent;

        navigator.clipboard
          .writeText(link)
          .then(() => {
            showNotification("Link berhasil disalin!", "success");
          })
          .catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = link;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showNotification("Link berhasil disalin!", "success");
          });
      }
    </script>
  </body>
</html>
